<!DOCTYPE html>

<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="Doconce: https://github.com/hplgit/doconce/" />
<meta name="description" content="Study Guide: Truncation Error Analysis">
<meta name="keywords" content="truncation error general,finite differences backward,truncation error Backward Euler scheme,finite differences forward,truncation error Forward Euler scheme,finite differences centered,truncation error Crank-Nicolson scheme,truncation error table of formulas,decay ODE,correction terms,truncation error correction terms,verification">







<!-- reveal.js: http://lab.hakim.se/reveal-js/ -->

<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

<link rel="stylesheet" href="reveal.js/css/reveal.css">
<link rel="stylesheet" href="reveal.js/css/theme/darkgray.css" id="theme">
<!--
<link rel="stylesheet" href="reveal.js/css/reveal.css">
<link rel="stylesheet" href="reveal.js/css/reveal.min.css">
<link rel="stylesheet" href="reveal.js/css/theme/beige.css" id="theme">
<link rel="stylesheet" href="reveal.js/css/theme/beigesmall.css" id="theme">
<link rel="stylesheet" href="reveal.js/css/theme/night.css" id="theme">
<link rel="stylesheet" href="reveal.js/css/theme/simple.css" id="theme">
<link rel="stylesheet" href="reveal.js/css/theme/sky.css" id="theme">
<link rel="stylesheet" href="reveal.js/css/theme/darkgray.css" id="theme">
-->

<script>
document.write( '<link rel="stylesheet" href="reveal.js/css/print/' + ( window.location.search.match( /print-pdf/gi ) ? 'pdf' : 'paper' ) + '.css" type="text/css" media="print">' );
</script>

<style type="text/css">
    hr { border: 0; width: 80%; border-bottom: 1px solid #aaa}
    p.caption { width: 80%; font-size: 60%; font-style: italic; text-align: left; }
    hr.figure { border: 0; width: 80%; border-bottom: 1px solid #aaa}
    .reveal .alert-text-small   { font-size: 80%;  }
    .reveal .alert-text-large   { font-size: 130%; }
    .reveal .alert-text-normal  { font-size: 90%;  }
    .reveal .alert {
             padding:8px 35px 8px 14px; margin-bottom:18px;
             text-shadow:0 1px 0 rgba(255,255,255,0.5);
             border:5px solid #bababa;
             -webkit-border-radius: 14px; -moz-border-radius: 14px;
             border-radius:14px
             background-position: 10px 10px;
             background-repeat: no-repeat;
             background-size: 38px;
             padding-left: 30px; /* 55px; if icon */
     }
     .reveal .alert-block {padding-top:14px; padding-bottom:14px}
     .reveal .alert-block > p, .alert-block > ul {margin-bottom:1em}
     /*.reveal .alert li {margin-top: 1em}*/
     .reveal .alert-block p+p {margin-top:5px}
     /*.reveal .alert-notice { background-image: url(https://doconce.googlecode.com/hg/bundled/html_images/small_gray_notice.png); }
     .reveal .alert-summary  { background-image:url(https://doconce.googlecode.com/hg/bundled/html_images/small_gray_summary.png); }
     .reveal .alert-warning { background-image: url(https://doconce.googlecode.com/hg/bundled/html_images/small_gray_warning.png); }
     .reveal .alert-question {background-image:url(https://doconce.googlecode.com/hg/bundled/html_images/small_gray_question.png); } */

</style>



<!-- Styles for table layout of slides -->
<style type="text/css">
td.padding {
  padding-top:20px;
  padding-bottom:20px;
  padding-right:50px;
  padding-left:50px;
}
</style>

</head>

<body>
<div class="reveal">

<!-- Any section element inside the <div class="slides"> container
     is displayed as a slide -->

<div class="slides">





<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  TeX: {
     equationNumbers: {  autoNumber: "AMS"  },
     extensions: ["AMSmath.js", "AMSsymbols.js", "autobold.js"]
  }
});
</script>
<script type="text/javascript"
 src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
<!-- Fix slow MathJax rendering in IE8 -->
<meta http-equiv="X-UA-Compatible" content="IE=EmulateIE7">


<!-- newcommands_keep.tex -->
$$
\newcommand{\uex}{u_{\small\mbox{e}}}
\newcommand{\vex}{v_{\small\mbox{e}}}
\newcommand{\Aex}{A_{\small\mbox{e}}}
\newcommand{\half}{\frac{1}{2}}
\newcommand{\halfi}{{1/2}}
\newcommand{\ts}{\thinspace .}

\newcommand{\Ddt}[1]{\frac{D #1}{dt}}
\newcommand{\E}[1]{\hbox{E}\lbrack #1 \rbrack}
\newcommand{\Var}[1]{\hbox{Var}\lbrack #1 \rbrack}
\newcommand{\Std}[1]{\hbox{Std}\lbrack #1 \rbrack}

\newcommand{\xpoint}{\boldsymbol{x}}
\newcommand{\normalvec}{\boldsymbol{n}}
\newcommand{\Oof}[1]{\mathcal{O}(#1)}

\newcommand{\x}{\boldsymbol{x}}
\newcommand{\X}{\boldsymbol{X}}
\renewcommand{\u}{\boldsymbol{u}}
\renewcommand{\v}{\boldsymbol{v}}
\newcommand{\w}{\boldsymbol{w}}
\newcommand{\V}{\boldsymbol{V}}
\newcommand{\e}{\boldsymbol{e}}
\newcommand{\f}{\boldsymbol{f}}
\newcommand{\F}{\boldsymbol{F}}
\newcommand{\stress}{\boldsymbol{\sigma}}
\newcommand{\strain}{\boldsymbol{\varepsilon}}
\newcommand{\stressc}{{\sigma}}
\newcommand{\strainc}{{\varepsilon}}
\newcommand{\I}{\boldsymbol{I}}
\newcommand{\T}{\boldsymbol{T}}

% Unit vectors
\newcommand{\ii}{\boldsymbol{i}}
\newcommand{\jj}{\boldsymbol{j}}
\newcommand{\kk}{\boldsymbol{k}}
\newcommand{\ir}{\boldsymbol{i}_r}
\newcommand{\ith}{\boldsymbol{i}_{\theta}}
\newcommand{\iz}{\boldsymbol{i}_z}

% Index sets
\newcommand{\Ix}{\mathcal{I}_x}
\newcommand{\Iy}{\mathcal{I}_y}
\newcommand{\Iz}{\mathcal{I}_z}
\newcommand{\It}{\mathcal{I}_t}
\newcommand{\setb}[1]{{#1}^0}    % set begin
\newcommand{\sete}[1]{{#1}^{-1}} % set end
%\newcommand{\setl}[1]{#1\setminus\{\set1{#1}\}}
%\newcommand{\setr}[1]{#1\setminus\{\set0{#1}\}}
%\newcommand{\seti}[1]{#1\setminus\{\set0{#1},\set1{#1}\}}
\newcommand{\setl}[1]{{#1}^-}
\newcommand{\setr}[1]{{#1}^+}
\newcommand{\seti}[1]{{#1}^i}

% Finite elements
\newcommand{\basphi}{\varphi}
\newcommand{\baspsi}{\psi}
\newcommand{\refphi}{\tilde\basphi}
\newcommand{\psib}{\boldsymbol{\psi}}
\newcommand{\sinL}[1]{\sin\left((#1+1)\pi\frac{x}{L}\right)}
\newcommand{\xno}[1]{x_{#1}}
%\newcommand{\xno}[1]{x^{(#1)}}
\newcommand{\Xno}[1]{X_{(#1)}}
\newcommand{\yno}[1]{y_{#1}}
\newcommand{\Yno}[1]{Y_{(#1)}}
\newcommand{\xdno}[1]{\boldsymbol{x}_{#1}}

% FEniCS commands
\newcommand{\dX}{\, \mathrm{d}X}
\newcommand{\dx}{\, \mathrm{d}x}
\newcommand{\ds}{\, \mathrm{d}s}
\newcommand{\Real}{\mathbb{R}}
\newcommand{\Integerp}{\mathbb{N}}
\newcommand{\Integer}{\mathbb{Z}}
$$




    



<section>
<!-- ------------------- main content ---------------------- -->


<title>Study Guide: Truncation Error Analysis</title>

<center><h1>Study Guide: Truncation Error Analysis</h1></center>  <!-- document title -->

<p>
<!-- author(s): Hans Petter Langtangen -->

<center>
<b>Hans Petter Langtangen</b> [1, 2]
</center>


<p>&nbsp;<br>
<!-- institution(s) -->

<center>[1] <b>Center for Biomedical Computing, Simula Research Laboratory</b></center>
<center>[2] <b>Department of Informatics, University of Oslo</b></center>
<p>&nbsp;<br>
<center><h4>Sep 15, 2013</h4></center> <!-- date -->
<p>

</section>


<section>

<h2>Table of contents</h2>

<p>
&nbsp; &nbsp; &nbsp; <a href="#___sec0"> Motivation for studying truncation errors </a><br>
&nbsp; &nbsp; &nbsp; <a href="#___sec1"> Abstract problem setting </a><br>
&nbsp; &nbsp; &nbsp; <a href="#___sec2"> Truncation error for a differential equation problem </a><br>
<a href="#trunc:finite:differences"> Computing truncation errors in finite difference formulas </a><br>
&nbsp; &nbsp; &nbsp; <a href="#trunc:fd:backward"> Example: The backward difference for \( u'(t) \) </a><br>
&nbsp; &nbsp; &nbsp; <a href="#___sec5"> Taylor series </a><br>
&nbsp; &nbsp; &nbsp; <a href="#___sec6"> Taylor series inserted in the backward difference approximation </a><br>
&nbsp; &nbsp; &nbsp; <a href="#trunc:fd:forward"> The forward difference for \( u'(t) \) </a><br>
&nbsp; &nbsp; &nbsp; <a href="#trunc:fd:central"> The central difference for \( u'(t) \) (1) </a><br>
&nbsp; &nbsp; &nbsp; <a href="#___sec9"> The central difference for \( u'(t) \) (1) </a><br>
&nbsp; &nbsp; &nbsp; <a href="#trunc:table"> Overview of leading-order error terms in finite difference formulas (1) </a><br>
&nbsp; &nbsp; &nbsp; <a href="#___sec11"> Overview of leading-order error terms in finite difference formulas (2) </a><br>
&nbsp; &nbsp; &nbsp; <a href="#___sec12"> Overview of leading-order error terms in averages </a><br>
&nbsp; &nbsp; &nbsp; <a href="#trunc:sympy"> Software for computing truncation errors </a><br>
&nbsp; &nbsp; &nbsp; <a href="#___sec14"> Symbolic computing with difference operators </a><br>
<a href="#trunc:decay"> Truncation errors in an ODE for exponential decay </a><br>
&nbsp; &nbsp; &nbsp; <a href="#trunc:decay:FE"> Truncation error of the Forward Euler scheme </a><br>
&nbsp; &nbsp; &nbsp; <a href="#trunc:decay:CN"> Truncation error of the Crank-Nicolson scheme </a><br>
&nbsp; &nbsp; &nbsp; <a href="#___sec18"> Test the understanding! </a><br>
&nbsp; &nbsp; &nbsp; <a href="#trunc:decay:theta"> Truncation error of the \( \theta \)-rule </a><br>
&nbsp; &nbsp; &nbsp; <a href="#trunc:decay:software"> Using symbolic software </a><br>
&nbsp; &nbsp; &nbsp; <a href="#trunc:decay:estimate:R"> Empirical verification of the truncation error (1) </a><br>
&nbsp; &nbsp; &nbsp; <a href="#___sec22"> Empirical verification of the truncation error (2) </a><br>
&nbsp; &nbsp; &nbsp; <a href="#___sec23"> Empirical verification of the truncation error in the Forward Euler scheme </a><br>
&nbsp; &nbsp; &nbsp; <a href="#trunc:decay:corr"> Increasing the accuracy by adding correction terms </a><br>
&nbsp; &nbsp; &nbsp; <a href="#___sec25"> Lowering the order of the derivative in the correction term </a><br>
&nbsp; &nbsp; &nbsp; <a href="#___sec26"> With a correction term Forward Euler becomes Crank-Nicolson </a><br>
&nbsp; &nbsp; &nbsp; <a href="#___sec27"> Correction terms in the Crank-Nicolson scheme </a><br>
&nbsp; &nbsp; &nbsp; <a href="#___sec28"> Extension to variable coefficients </a><br>
&nbsp; &nbsp; &nbsp; <a href="#___sec29"> Exact solutions of the finite difference equations </a><br>
&nbsp; &nbsp; &nbsp; <a href="#trunc:decay:gen"> Computing truncation errors in nonlinear problems (1) </a><br>
&nbsp; &nbsp; &nbsp; <a href="#___sec31"> Computing truncation errors in nonlinear problems (2) </a><br>
<a href="#trunc:vib"> Truncation errors in vibration ODEs </a><br>
&nbsp; &nbsp; &nbsp; <a href="#___sec33"> Linear model without damping </a><br>
&nbsp; &nbsp; &nbsp; <a href="#___sec34"> Computing correction terms </a><br>
&nbsp; &nbsp; &nbsp; <a href="#trunc:vib:gen"> Model with damping and nonlinearity </a><br>
&nbsp; &nbsp; &nbsp; <a href="#___sec36"> Model with damping and nonlinearity: truncation error analysis </a><br>
&nbsp; &nbsp; &nbsp; <a href="#___sec37"> Extension to quadratic damping </a><br>
&nbsp; &nbsp; &nbsp; <a href="#___sec38"> The truncation error for quadratic damping (1) </a><br>
&nbsp; &nbsp; &nbsp; <a href="#___sec39"> The truncation error for quadratic damping (2) </a><br>
&nbsp; &nbsp; &nbsp; <a href="#trunc:vib:gen:staggered"> The general model formulated as first-order ODEs </a><br>
&nbsp; &nbsp; &nbsp; <a href="#___sec41"> The forward-backward scheme </a><br>
&nbsp; &nbsp; &nbsp; <a href="#___sec42"> Truncation error analysis </a><br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#___sec43"> A centered scheme on a staggered mesh </a><br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#___sec44"> A centered scheme on a staggered mesh: truncation error analysis </a><br>

<p>

</section>


<section>

<h3>Motivation for studying truncation errors  <a name="___sec0"></a></h3>

<p>

<ul>
 <p><li> Definition: The <em>truncation error</em> is the discrepancy that
   arises from performing a finite number of steps to approximate a
   process with infinitely many steps.</li>
 <p><li> Widely used: truncation of infinite series, finite
   precision arithmetic, finite differences, and differential equations.</li>
 <p><li> Why? The truncation error is an error measure that is easy to compute.</li>
</ul>
<p>


</section>


<section>

<h3>Abstract problem setting  <a name="___sec1"></a></h3>

<p>
Consider an abstract differential equation

<p>
<p>&nbsp;<br>
$$ \mathcal{L}(u)=0\ts$$
<p>&nbsp;<br>

Example: \( \mathcal{L}(u)=u'(t)+a(t)u(t)-b(t) \).

<p>
The corresponding discrete equation:

<p>
<p>&nbsp;<br>
$$ \mathcal{L}_{\Delta}(u) =0\ts$$
<p>&nbsp;<br>

Let now

<p>

<ul>
 <p><li> \( u \) be the numerical solution of the discrete equations</li>
 <p><li> \( \uex \) the exact solution of the differential equation</li>
</ul>
<p>

Then

<p>
<p>&nbsp;<br>
$$
\begin{align*}
 \mathcal{L}(\uex)&=0,\\ 
 \mathcal{L}_\Delta(u)&=0\ts
\end{align*}
$$
<p>&nbsp;<br>

The numerical solution is computed at mesh points: \( u^n \), \( n=0,\ldots,N_t \).

<p>

</section>


<section>

<h3>Truncation error for a differential equation problem  <a name="___sec2"></a></h3>

<p>

<ul>
 <p><li> Dream: \( e^n = \uex(t_n)-u^n \)</li>
 <p><li> Impossible, except for very simple problems</li>
 <p><li> Must find other error measures that are easier to calculate</li>
 <p><li> To what extent does \( \uex \) fulfill \( \mathcal{L}_\Delta(\uex)=0 \)?</li>
 <p><li> It does not fit, but we can measure the error \( \mathcal{L}_\Delta(\uex)=R \)</li>
 <p><li> \( R \) is the truncation error and it is easy to compute</li>
</ul>
<p>


</section>


<section>

<h2>Computing truncation errors in finite difference formulas <a name="trunc:finite:differences"></a></h2>

<p>

</section>


<section>

<h3>Example: The backward difference for \( u'(t) \) <a name="trunc:fd:backward"></a></h3>

<p>
Backward difference approximation to \( u' \):

<p>
<p>&nbsp;<br>
$$
\begin{equation}
\lbrack D_t^- u\rbrack^n  = \frac{u^{n} - u^{n-1}}{\Delta t} \approx u'(t_n)
\label{trunc:fd:bw1}
\thinspace .
\end{equation}
$$
<p>&nbsp;<br>


<p>
Define the truncation error of this approximation as

<p>
<p>&nbsp;<br>
$$
\begin{equation}
R^n = u'(t_n) - [D^-_tu]^n\ts
\label{trunc:fd:bw3}
\end{equation}
$$
<p>&nbsp;<br>


<p>
The common way of calculating \( R^n \) is to

<p>

<ol>
<p><li> expand \( u(t) \) in a Taylor series around the point where the
   derivative is evaluated, here \( t_n \),</li>
<p><li> insert this Taylor series in \eqref{trunc:fd:bw3},
   and</li>
<p><li> collect terms that cancel and simplify the expression.</li>
</ol>
<p>


</section>


<section>

<h3>Taylor series  <a name="___sec5"></a></h3>

<p>
General Taylor series expansion from calculus:

<p>
<p>&nbsp;<br>
$$ f(x+h) = \sum_{i=0}^\infty \frac{1}{i!}\frac{d^if}{dx^i}(x)h^i\thinspace . $$
<p>&nbsp;<br>


<p>
Here: expand \( u^{n-1} \) around \( t_n \):

<p>
<p>&nbsp;<br>
$$
\begin{align*}
u(t_{n-1}) = u(t-\Delta t) &= \sum_{i=0}^\infty \frac{1}{i!}\frac{d^iu}{dt^i}(t_n)(-\Delta t)^i\\ 
& = u(t_n) - u'(t_n)\Delta t + \frac{1}{2}u''(t_n)\Delta t^2
+ \Oof{\Delta t^3},
\end{align*}
$$
<p>&nbsp;<br>


<p>

<ul>
 <p><li> \( \Oof{\Delta t^3} \): power-series in \( \Delta t \) where
   the lowest power is \( \Delta t^3 \)</li>
 <p><li> Small \( \Delta t \): \( \Delta t \gg \Delta t^3 \gg \Delta t^4 \)</li>
</ul>
<p>


</section>


<section>

<h3>Taylor series inserted in the backward difference approximation  <a name="___sec6"></a></h3>

<p>
<p>&nbsp;<br>
$$
\begin{align*}
u'(t_n) - [D_t^-u]^n &= u'(t_n) - \frac{u(t_n) - u(t_{n-1})}{\Delta t}\\ 
&= u'(t_n) - \frac{u(t_n) - (u(t_n) - u'(t_n)\Delta t + \frac{1}{2}u''(t_n)\Delta t^2 + \Oof{\Delta t^3} )}{\Delta t}\\ 
&= \frac{1}{2}u''(t_n)\Delta t + \Oof{\Delta t^2} )
\end{align*}
$$
<p>&nbsp;<br>


<p>
Result:

<p>
<p>&nbsp;<br>
$$
\begin{equation}
R^n = \frac{1}{2}u''(t_n)\Delta t + \Oof{\Delta t^2} )
\thinspace .
\end{equation}
$$
<p>&nbsp;<br>

The difference approximation is of
<em>first order</em> in \( \Delta t \). It is exact for linear \( \uex \).

<p>

</section>


<section>

<h3>The forward difference for \( u'(t) \) <a name="trunc:fd:forward"></a></h3>

<p>
Forward difference:

<p>
<p>&nbsp;<br>
$$ u'(t_n) \approx [D_t^+ u]^n = \frac{u^{n+1}-u^n}{\Delta t}\ts$$
<p>&nbsp;<br>

Define the truncation error:
<p>&nbsp;<br>
$$ u'(t_n) = [D_t^+ u]^n + R^n\ts$$
<p>&nbsp;<br>

Expand \( u^{n+1} \) in a Taylor series around \( t_n \),
<p>&nbsp;<br>
$$ u(t_{n+1}) = u(t_n) + u'(t_n)\Delta t +
\frac{1}{2}u''(t_n)\Delta t^2 + \Oof{\Delta t^3}
\thinspace . $$
<p>&nbsp;<br>

We get
<p>&nbsp;<br>
$$ R = -\frac{1}{2}u''(t_n)\Delta t +
\Oof{\Delta t^2}\ts$$
<p>&nbsp;<br>


<p>

</section>


<section>

<h3>The central difference for \( u'(t) \) (1) <a name="trunc:fd:central"></a></h3>

<p>
For the central difference approximation,
<p>&nbsp;<br>
$$ u'(t_n)\approx [ D_tu]^n, \quad [D_tu]^n =
\frac{u^{n+\frac{1}{2}} - u^{n-\frac{1}{2}}}{\Delta t},
$$
<p>&nbsp;<br>

we write

<p>
<p>&nbsp;<br>
$$ u'(t_n) - [ D_tu]^n = R^n,$$
<p>&nbsp;<br>

and expand \( u(t_{n+\frac{1}{2}}) \) and
\( u(t_{n-1/2}) \) in Taylor series around the point \( t_n \) where
the derivative is evaluated:
<p>&nbsp;<br>
$$
\begin{align*}
u(t_{n+\frac{1}{2}}) = &u(t_n) + u'(t_n)\frac{1}{2}\Delta t +
\frac{1}{2}u''(t_n)(\frac{1}{2}\Delta t)^2 + \\ 
& \frac{1}{6}u'''(t_n) (\frac{1}{2}\Delta t)^3
+ \frac{1}{24}u''''(t_n) (\frac{1}{2}\Delta t)^4 + \Oof{\Delta t^5}\\ 
u(t_{n-1/2}) = &u(t_n) - u'(t_n)\frac{1}{2}\Delta t +
\frac{1}{2}u''(t_n)(\frac{1}{2}\Delta t)^2 - \\ 
& \frac{1}{6}u'''(t_n) (\frac{1}{2}\Delta t)^3
+ \frac{1}{24}u''''(t_n) (\frac{1}{2}\Delta t)^4 + \Oof{\Delta t^5}
\thinspace .
\end{align*}
$$
<p>&nbsp;<br>


<p>

</section>


<section>

<h3>The central difference for \( u'(t) \) (1)  <a name="___sec9"></a></h3>

<p>
<p>&nbsp;<br>
$$
u(t_{n+\frac{1}{2}}) - u(t_{n-1/2}) = u'(t_n)\Delta t + \frac{1}{24}u'''(t_n) \Delta t^3 +  \Oof{\Delta t^5}
\thinspace .
$$
<p>&nbsp;<br>

Collecting terms in \( [u'=D_tu + R]^n \) we find

<p>
<p>&nbsp;<br>
$$
\begin{equation}
R = -\frac{1}{24}u'''(t_n)\Delta t^2 + \Oof{\Delta t^4},
\end{equation}
$$
<p>&nbsp;<br>

Note:

<p>

<ul>
 <p><li> Second-order scheme since the leading term is \( \Delta t^2 \)</li>
 <p><li> Only even powers of \( \Delta t \)</li>
</ul>
<p>


</section>


<section>

<h3>Overview of leading-order error terms in finite difference formulas (1) <a name="trunc:table"></a></h3>

<p>
<p>&nbsp;<br>
$$
\begin{align}
[D_tu]^n &= \frac{u^{n+\frac{1}{2}} - u^{n-\frac{1}{2}}}{\Delta t} = u'(t_n)
 + R^n \nonumber,\\ 
R^n &= \frac{1}{24}u'''(t_n)\Delta t^2 + \Oof{\Delta t^4}
\label{trunc:fd1:center}\\ 
[D_{2t}u]^n &= \frac{u^{n+1} - u^{n-1}}{2\Delta t} = u'(t_n)
 + R^n\nonumber,\\ 
R^n &= \frac{1}{6}u'''(t_n)\Delta t^2 + \Oof{\Delta t^4}
\label{trunc:fd1:center2}\\ 
[D_t^-u]^n &= \frac{u^{n} - u^{n-1}}{\Delta t} = u'(t_n) +
R^n\nonumber,\\ 
R^n &= \frac{1}{2}u''(t_n)\Delta t + \Oof{\Delta t^2}
\label{trunc:fd1:bw}\\ 
[D_t^+u]^n &= \frac{u^{n+1} - u^{n}}{\Delta t} = u'(t_n) +
R^n\nonumber,\\ 
R^n &= \frac{1}{2}u''(t_n)\Delta t + \Oof{\Delta t^2}
\label{trunc:fd1:fw}
\end{align}
$$
<p>&nbsp;<br>


<p>

</section>


<section>

<h3>Overview of leading-order error terms in finite difference formulas (2)  <a name="___sec11"></a></h3>

<p>
<p>&nbsp;<br>
$$
\begin{align}
[\bar D_tu]^{n+\theta} &= \frac{u^{n+1} - u^{n}}{\Delta t} = u'(t_{n+\theta}) +
R^{n+\theta}\nonumber,\\ 
R^{n+\theta} &= \frac{1}{2}(1-2\theta)u''(t_{n+\theta})\Delta t -
\frac{1}{6}((1 - \theta)^3 - \theta^3)u'''(t_{n+\theta})\Delta t^2 +
\Oof{\Delta t^3}
\label{trunc:fd1:theta}\\ 
[D_t^{2-}u]^n &= \frac{3u^{n} - 4u^{n-1} + u^{n-2}}{2\Delta t} = u'(t_n) +
R^n\nonumber,\\ 
R^n &= -\frac{1}{3}u'''(t_n)\Delta t^2 + \Oof{\Delta t^3}
\label{trunc:fd1:bw2}\\ 
[D_tD_t u]^n &= \frac{u^{n+1} - 2u^{n} + u^{n-1}}{\Delta t^2} = u''(t_n) +
R^n\nonumber,\\ 
R^n &= \frac{1}{12}u''''(t_n)\Delta t^2 + \Oof{\Delta t^4}
\label{trunc:fd2:center}
\end{align}
$$
<p>&nbsp;<br>


<p>

</section>


<section>

<h3>Overview of leading-order error terms in averages  <a name="___sec12"></a></h3>

<p>
Weighted arithmetic mean:
<p>&nbsp;<br>
$$
\begin{align}
[\overline{u}^{t,\theta}]^{n+\theta}
& = \theta u^{n+1} + (1-\theta)u^n =
u(t_{n+\theta}) + R^{n+\theta},\nonumber\\ 
R^{n+\theta} &= \frac{1}{2}u''(t_{n+\theta})\Delta t^2\theta (1-\theta) +
\Oof{\Delta t^3}
\thinspace .
\label{trunc:avg:theta}
\end{align}
$$
<p>&nbsp;<br>

Standard arithmetic mean:

<p>
<p>&nbsp;<br>
$$
\begin{align}
[\overline{u}^{t}]^{n} &= \frac{1}{2}(u^{n-\frac{1}{2}} + u^{n+\frac{1}{2}})
= u(t_n) + R^{n},\nonumber\\ 
R^{n} &= \frac{1}{8}u''(t_{n})\Delta t^2 + \frac{1}{384}u''''(t_n)\Delta t^4
+ \Oof{\Delta t^6}\ts
\label{trunc:avg:arith}
\end{align}
$$
<p>&nbsp;<br>


<p>
Geometric mean:

<p>
<p>&nbsp;<br>
$$
\begin{align}
u^{n-\frac{1}{2}}u^{n+\frac{1}{2}} &= (u^n)^2 + R^n,\nonumber\\ 
R^n &= - \frac{1}{4}u'(t_n)^2\Delta t^2  + \frac{1}{4}u(t_n)u''(t_n)\Delta t^2
+ \Oof{\Delta t^4}
\thinspace .
\label{trunc:avg:geom}
\end{align}
$$
<p>&nbsp;<br>


<p>
Harmonic mean:

<p>
<p>&nbsp;<br>
$$
\begin{align}
u^n &= \frac{2}{\frac{1}{u^{n-\frac{1}{2}}} + \frac{1}{u^{n+\frac{1}{2}}}}
+ R^{n+\frac{1}{2}},\nonumber\\ 
R^n &= - \frac{u'(t_n)^2}{4u(t_n)}\Delta t^2 + \frac{1}{8}u''(t_n)\Delta t^2
\thinspace .
\label{trunc:avg:harm}
\end{align}
$$
<p>&nbsp;<br>


<p>

</section>


<section>

<h3>Software for computing truncation errors <a name="trunc:sympy"></a></h3>

<p>
Can use <code>sympy</code> to automate calculations with Taylor series.

<p>

<!-- code=text (from !bc ipy) typeset with pygments style "native" -->
<div class="highlight" style="background: #202020"><pre style="line-height: 125%">&gt;&gt;&gt; from truncation_errors import TaylorSeries
&gt;&gt;&gt; from sympy import *
&gt;&gt;&gt; u, dt = symbols(&#39;u dt&#39;)
&gt;&gt;&gt; u_Taylor = TaylorSeries(u, 4)
&gt;&gt;&gt; u_Taylor(dt)
D1u*dt + D2u*dt**2/2 + D3u*dt**3/6 + D4u*dt**4/24 + u
&gt;&gt;&gt; FE = (u_Taylor(dt) - u)/dt
&gt;&gt;&gt; FE
(D1u*dt + D2u*dt**2/2 + D3u*dt**3/6 + D4u*dt**4/24)/dt
&gt;&gt;&gt; simplify(FE)
D1u + D2u*dt/2 + D3u*dt**2/6 + D4u*dt**3/24
</pre></div>
<p>
Notation: <code>D1u</code> for \( u' \), <code>D2u</code> for \( u'' \), etc.

<p>
See <a href="http://tinyurl.com/jvzzcfn/trunc/truncation_errors.py"><tt>trunc/truncation_errors.py</tt></a>.

<p>

</section>


<section>

<h3>Symbolic computing with difference operators  <a name="___sec14"></a></h3>

<p>
A class <code>DiffOp</code> represents many common difference operatorsL

<p>

<!-- code=text typeset with pygments style "native" -->
<div class="highlight" style="background: #202020"><pre style="line-height: 125%">&gt;&gt;&gt; from truncation_errors import DiffOp
&gt;&gt;&gt; from sympy import *
&gt;&gt;&gt; u = Symbol(&#39;u&#39;)
&gt;&gt;&gt; diffop = DiffOp(u, independent_variable=&#39;t&#39;)
&gt;&gt;&gt; diffop[&#39;geometric_mean&#39;]
-D1u**2*dt**2/4 - D1u*D3u*dt**4/48 + D2u**2*dt**4/64 + ...
&gt;&gt;&gt; diffop[&#39;Dtm&#39;]
D1u + D2u*dt/2 + D3u*dt**2/6 + D4u*dt**3/24
&gt;&gt;&gt; diffop.operator_names()
[&#39;geometric_mean&#39;, &#39;harmonic_mean&#39;, &#39;Dtm&#39;, &#39;D2t&#39;, &#39;DtDt&#39;,
 &#39;weighted_arithmetic_mean&#39;, &#39;Dtp&#39;, &#39;Dt&#39;]
</pre></div>
<p>
Names in <code>diffop</code>:
<code>Dtp</code> for \( D^+_t \), <code>Dtm</code> for \( D_t^- \), <code>Dt</code> for \( D_t \), <code>D2t</code> for
\( D_{2t} \), <code>DtDt</code> for \( D_tD_t \).

<p>

</section>


<section>

<h2>Truncation errors in an ODE for exponential decay <a name="trunc:decay"></a></h2>

<p>
Model:

<p>
<p>&nbsp;<br>
$$
\begin{equation}
u'(t)=-au(t),\quad u(0)=I\thinspace .
\label{trunc:decay:ode}
\end{equation}
$$
<p>&nbsp;<br>


<p>

</section>


<section>

<h3>Truncation error of the Forward Euler scheme <a name="trunc:decay:FE"></a></h3>

<p>
The Forward Euler scheme:

<p>
<p>&nbsp;<br>
$$
\begin{equation}
[D_t^+ u = -au]^n
\label{trunc:decay:FE:scheme}
\thinspace .
\end{equation}
$$
<p>&nbsp;<br>

Definition of the truncation error \( R^n \):

<p>
<p>&nbsp;<br>
$$
\begin{equation}
[D_t^+ \uex + a\uex = R]^n
\label{trunc:decay:FE:uex}
\thinspace .
\end{equation}
$$
<p>&nbsp;<br>

From \eqref{trunc:fd1:fw}:
<p>&nbsp;<br>
$$ [D_t^+ \uex]^n = \uex'(t_n) +
\frac{1}{2}\uex''(t_n)\Delta t + \Oof{\Delta t^2}\ts$$
<p>&nbsp;<br>

Inserted in \eqref{trunc:decay:FE:uex}:
<p>&nbsp;<br>
$$
\uex'(t_n) +
\frac{1}{2}\uex''(t_n)\Delta t + \Oof{\Delta t^2}
+ a\uex(t_n) = R^n
\thinspace .
$$
<p>&nbsp;<br>

Key observation: \( \uex'(t_n) + a\uex^n = 0 \) since \( \uex \) solves the ODE.
The remaining terms constitute the residual:
<p>&nbsp;<br>
$$
\begin{equation}
R^n = \frac{1}{2}\uex''(t_n)\Delta t + \Oof{\Delta t^2}
\label{trunc:decay:FE:R}
\thinspace .
\end{equation}
$$
<p>&nbsp;<br>

Largest term in \( R^n \) is proportional to \( \Delta t \), hence a
first-order (in \( \Delta t \)) scheme.

<p>

</section>


<section>

<h3>Truncation error of the Crank-Nicolson scheme <a name="trunc:decay:CN"></a></h3>

<p>
Crank-Nicolson:
<p>&nbsp;<br>
$$
\begin{equation}
[D_t u = -au]^{n+\frac{1}{2}},
\end{equation}
$$
<p>&nbsp;<br>

Truncation error:

<p>
<p>&nbsp;<br>
$$
\begin{equation}
[D_t \uex + a\overline{\uex}^{t} = R]^{n+\frac{1}{2}}
\thinspace .
\label{trunc:decay:CN:scheme:R}
\end{equation}
$$
<p>&nbsp;<br>


<p>
From \eqref{trunc:fd1:center} and \eqref{trunc:avg:arith}:
<p>&nbsp;<br>
$$
\begin{align*}
[D_t\uex]^{n+\frac{1}{2}} &= u'(t_{n+\frac{1}{2}}) +
\frac{1}{24}\uex'''(t_{n+\frac{1}{2}})\Delta t^2 + \Oof{\Delta t^4},\\ 
[a\overline{\uex}^{t}]^{n+\frac{1}{2}}
&= u(t_{n+\frac{1}{2}}) + \frac{1}{8}u''(t_{n})\Delta t^2 +
+ \Oof{\Delta t^4}
\end{align*}
$$
<p>&nbsp;<br>

Inserted in the scheme we get
<p>&nbsp;<br>
$$
\begin{equation}
R^{n+\frac{1}{2}} = \left(
\frac{1}{24}\uex'''(t_{n+\frac{1}{2}}) + \frac{1}{8}u''(t_{n})
\right)\Delta t^2 + \Oof{\Delta t^4}
\end{equation}
$$
<p>&nbsp;<br>

\( R^n = \Oof{\Delta t^2} \) (second-order scheme)

<p>

</section>


<section>

<h3>Test the understanding!  <a name="___sec18"></a></h3>

<p>
Analyze the the truncation error of the Backward Euler scheme.

<p>

</section>


<section>

<h3>Truncation error of the \( \theta \)-rule <a name="trunc:decay:theta"></a></h3>

<p>
The \( \theta \)-rule:
<p>&nbsp;<br>
$$
[\bar D_t u = -a\overline{u}^{t,\theta}]^{n+\theta}
\thinspace .
$$
<p>&nbsp;<br>


<p>
Truncation error:
<p>&nbsp;<br>
$$
[\bar D_t \uex  + a\overline{\uex}^{t,\theta} = R]^{n+\theta}
\thinspace .
$$
<p>&nbsp;<br>

Use \eqref{trunc:fd1:theta} and \eqref{trunc:avg:theta} along with
\( \uex'(t_{n+\theta}) + a\uex(t_{n+\theta})=0 \) to show

<p>
<!-- -D2u*a*dt**2*theta**2/2 + D2u*a*dt**2*theta/2 - D2u*dt*theta + D2u*dt/2  + D3u*dt**2*theta**2/2 - D3u*dt**2*theta/2 + D3u*dt**2/6 -->

<p>
<p>&nbsp;<br>
$$
\begin{align}
R^{n+\theta}
=
&(\frac{1}{2}-\theta)\uex''(t_{n+\theta})\Delta t +
\frac{1}{2}\theta (1-\theta)\uex''(t_{n+\theta})\Delta t^2 + \nonumber\\ 
& \frac{1}{2}(\theta^2 -\theta + 3)\uex'''(t_{n+\theta})\Delta t^2
+ \Oof{\Delta t^3}
\end{align}
$$
<p>&nbsp;<br>

Note: 2nd-order scheme if and only if \( \theta =1/2 \).

<p>

</section>


<section>

<h3>Using symbolic software <a name="trunc:decay:software"></a></h3>

<p>
Can use <code>sympy</code> and the tools in
<a href="http://tinyurl.com/jvzzcfn/trunc/truncation_errors.py"><tt>trunc/truncation_errors.py</tt></a>:

<p>

<!-- code=python (from !bc pycod) typeset with pygments style "native" -->
<div class="highlight" style="background: #202020"><pre style="line-height: 125%"><span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">decay</span><span style="color: #d0d0d0">():</span>
    <span style="color: #d0d0d0">u,</span> <span style="color: #d0d0d0">a</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">sm.symbols(</span><span style="color: #ed9d13">&#39;u a&#39;</span><span style="color: #d0d0d0">)</span>
    <span style="color: #d0d0d0">diffop</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">DiffOp(u,</span> <span style="color: #d0d0d0">independent_variable=</span><span style="color: #ed9d13">&#39;t&#39;</span><span style="color: #d0d0d0">,</span>
                    <span style="color: #d0d0d0">num_terms_Taylor_series=</span><span style="color: #3677a9">3</span><span style="color: #d0d0d0">)</span>
    <span style="color: #d0d0d0">D1u</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">diffop.D(</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">)</span>   <span style="color: #999999; font-style: italic"># symbol for du/dt</span>
    <span style="color: #d0d0d0">ODE</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">D1u</span> <span style="color: #d0d0d0">+</span> <span style="color: #d0d0d0">a*u</span>     <span style="color: #999999; font-style: italic"># define ODE</span>

    <span style="color: #999999; font-style: italic"># Define schemes</span>
    <span style="color: #d0d0d0">FE</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">diffop[</span><span style="color: #ed9d13">&#39;Dtp&#39;</span><span style="color: #d0d0d0">]</span> <span style="color: #d0d0d0">+</span> <span style="color: #d0d0d0">a*u</span>
    <span style="color: #d0d0d0">CN</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">diffop[</span><span style="color: #ed9d13">&#39;Dt&#39;</span> <span style="color: #d0d0d0">]</span> <span style="color: #d0d0d0">+</span> <span style="color: #d0d0d0">a*u</span>
    <span style="color: #d0d0d0">BE</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">diffop[</span><span style="color: #ed9d13">&#39;Dtm&#39;</span><span style="color: #d0d0d0">]</span> <span style="color: #d0d0d0">+</span> <span style="color: #d0d0d0">a*u</span>
    <span style="color: #999999; font-style: italic"># Residuals (truncation errors)</span>
    <span style="color: #d0d0d0">R</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">{</span><span style="color: #ed9d13">&#39;FE&#39;</span><span style="color: #d0d0d0">:</span> <span style="color: #d0d0d0">FE-ODE,</span> <span style="color: #ed9d13">&#39;BE&#39;</span><span style="color: #d0d0d0">:</span> <span style="color: #d0d0d0">BE-ODE,</span> <span style="color: #ed9d13">&#39;CN&#39;</span><span style="color: #d0d0d0">:</span> <span style="color: #d0d0d0">CN-ODE}</span>
    <span style="color: #6ab825; font-weight: bold">return</span> <span style="color: #d0d0d0">R</span>
</pre></div>
<p>
The returned dictionary becomes

<p>

<!-- code=text typeset with pygments style "native" -->
<div class="highlight" style="background: #202020"><pre style="line-height: 125%">decay: {
 &#39;BE&#39;: D2u*dt/2 + D3u*dt**2/6,
 &#39;FE&#39;: -D2u*dt/2 + D3u*dt**2/6,
 &#39;CN&#39;: D3u*dt**2/24,
}
</pre></div>
<p>
\( \theta \)-rule: see <code>truncation_errors.py</code> (long expression, very advantageous
to automate the math)

<p>

</section>


<section>

<h3>Empirical verification of the truncation error (1) <a name="trunc:decay:estimate:R"></a></h3>

<p>
Ideas:

<p>

<ul>
 <p><li> Compute \( R^n \) numerically</li>
 <p><li> Run a sequence of meshes, see how \( R^n \) converges</li>
</ul>
<p>

For the Forward Euler scheme:

<p>
<p>&nbsp;<br>
$$
\begin{equation}
R^n = [D_t^+\uex + a\uex]^n
\label{trunc:decay:FE:R:comp}
\thinspace .
\end{equation}
$$
<p>&nbsp;<br>

Insert correct \( \uex(t) \), or add source term to fit any choice of
\( \uex \).

<p>

</section>


<section>

<h3>Empirical verification of the truncation error (2)  <a name="___sec22"></a></h3>

<p>

<ul>
 <p><li> Assume \( R = C\Delta t^r \)</li>
 <p><li> \( R \) varies with \( n \); \( C \) and \( r \) will vary with \( n \) - must estimate
   \( r \) for each mesh point</li>
 <p><li> Use a sequence of meshes: \( N_t = 2^{-k}N_0 \), \( k=1,2,\ldots \)</li>
 <p><li> Transform \( R \) data to the coarsest mesh and estimate \( r \) for
   each coarse mesh point</li>
</ul>
<p>

See the <a href="http://tinyurl.com/k3sdbuv/pub/">text</a> for more details and an implementation.

<p>

</section>


<section>

<h3>Empirical verification of the truncation error in the Forward Euler scheme  <a name="___sec23"></a></h3>

<p>
<center> <!-- figure -->
<hr class="figure">
<center><p class="caption">Figure 1:  Estimated truncation error at mesh points for different meshes. <a name="trunc:fig:FE:rates"></a> </p></center>
<p><img src="fig-trunc/R_series.png" align="bottom" width=400></p>
</center>

<p>
<center> <!-- figure -->
<hr class="figure">
<center><p class="caption">Figure 2:  Difference between theoretical and estimated truncation error at mesh points for different meshes. <a name="trunc:fig:FE:error"></a> </p></center>
<p><img src="fig-trunc/R_error.png" align="bottom" width=400></p>
</center>

<p>

</section>


<section>

<h3>Increasing the accuracy by adding correction terms <a name="trunc:decay:corr"></a></h3>

<p>
<div class="alert alert-block alert-question alert-text-normal"><b>Question.</b>
Can we add terms in the differential equation
that can help increase the order of the truncation error?

<p>
To be precise for the Forward Euler scheme, can we find \( C \)
to make \( R \) $\Oof{\Delta t^2}$?

<p>
<p>&nbsp;<br>
$$
\begin{equation}
\lbrack D_t^+ \uex + a\uex = C + R \rbrack^n\ts
\label{trunc:decay:FE:corr}
\end{equation}
$$
<p>&nbsp;<br>
</div>
<p>
Taylor expand:
<p>&nbsp;<br>
$$
\frac{1}{2}\uex''(t_n)\Delta t - \frac{1}{6}\uex'''(t_n)\Delta t^2
+ \Oof{\Delta t^3}  = C^n + R^n\ts$$
<p>&nbsp;<br>

Observe: choosing

<p>
<p>&nbsp;<br>
$$ C^n = \frac{1}{2}\uex''(t_n)\Delta t,$$
<p>&nbsp;<br>

makes

<p>
<p>&nbsp;<br>
$$ R^n = \frac{1}{6}\uex'''(t_n)\Delta t^2 + \Oof{\Delta t^3}\ts$$
<p>&nbsp;<br>


<p>

</section>


<section>

<h3>Lowering the order of the derivative in the correction term  <a name="___sec25"></a></h3>

<p>

<ul>
 <p><li> \( C^n \) contains \( u'' \)</li>
 <p><li> Can discretize \( u'' \) (one more time level)</li>
 <p><li> Can also rewrite to \( u' \) or \( u \)</li>
</ul>
<p>

<p>&nbsp;<br>
$$ u' = -au,\quad\Rightarrow\quad u''=-au'=a^u\ts$$
<p>&nbsp;<br>

Result for \( u''=a^u \): apply Forward Euler to a <em>perturbed ODE</em>,

<p>
<p>&nbsp;<br>
$$
\begin{equation}
u' = -\hat au ,\quad \hat a = a(1 - \frac{1}{2}a\Delta t)\ts
\label{trunc:decay:corr:FE:ODE}
\end{equation}
$$
<p>&nbsp;<br>


<p>

</section>


<section>

<h3>With a correction term Forward Euler becomes Crank-Nicolson  <a name="___sec26"></a></h3>

<p>
Use \( u''=-au' \):

<p>
<p>&nbsp;<br>
$$ u'=-au - \frac{1}{2}a\Delta t u'\quad\Rightarrow\quad
\left( 1 + \frac{1}{2}a\Delta t\right) u' = -au\ts$$
<p>&nbsp;<br>

Apply Forward Euler:

<p>
<p>&nbsp;<br>
$$
\left( 1 + \frac{1}{2}a\Delta t\right)\frac{u^{n+1}-u^n}{\Delta t}
= -au^n,$$
<p>&nbsp;<br>

which after some algebra can be written as

<p>
<p>&nbsp;<br>
$$ u^{n+1} = \frac{1 - \frac{1}{2}a\Delta t}{1+\frac{1}{2}a\Delta t}u^n\ts$$
<p>&nbsp;<br>

This is a Crank-Nicolson scheme for \( u'=-au \)!

<p>

</section>


<section>

<h3>Correction terms in the Crank-Nicolson scheme  <a name="___sec27"></a></h3>

<p>
Standard Crank-Nicolson scheme:

<p>
<p>&nbsp;<br>
$$ [D_t u = -au ]^{n+\frac{1}{2}},$$
<p>&nbsp;<br>

Definition of the truncation error \( R \) and correction terms \( C \):

<p>
<p>&nbsp;<br>
$$ [D_t \uex + a\overline{\uex}^{t} = C + R]^{n+\frac{1}{2}}\ts$$
<p>&nbsp;<br>


<p>
Must Taylor expand

<p>

<ul>
 <p><li> the derivative</li>
 <p><li> the arithmetic mean</li>
</ul>
<p>

<p>&nbsp;<br>
$$
C^{n+\frac{1}{2}} + R^{n+\frac{1}{2}} =
\frac{1}{24}\uex'''(t_{n+\frac{1}{2}})\Delta t^2
+ \frac{a}{8}\uex''(t_{n+\frac{1}{2}})\Delta t^2 + \Oof{\Delta t^4}\ts$$
<p>&nbsp;<br>

Let \( C^{n+\frac{1}{2}} \) cancel the \( \Delta t^2 \) terms:

<p>
<p>&nbsp;<br>
$$ C^{n+\frac{1}{2}} =
\frac{1}{24}\uex'''(t_{n+\frac{1}{2}})\Delta t^2
+ \frac{a}{8}\uex''(t_{n})\Delta t^2\ts$$
<p>&nbsp;<br>

Using \( u'=-au \), we have \( u''=a^2u \) and \( u'''=-a3u \).

<p>
Result: solve the perturbed ODE by a Crank-Nicolson method,

<p>
<p>&nbsp;<br>
$$ u' = -\hat a u,\quad \hat a = a(1 - \frac{1}{12}a^2\Delta t^2)\ts$$
<p>&nbsp;<br>

Error: \( \Oof{\Delta t^4} \).

<p>

</section>


<section>

<h3>Extension to variable coefficients  <a name="___sec28"></a></h3>

<p>
<p>&nbsp;<br>
$$ u'(t) = -a(t)u(t) + b(t),\quad u(0)=I,$$
<p>&nbsp;<br>


<p>
Forward Euler:

<p>
<p>&nbsp;<br>
$$
\begin{equation}
[D_t^+ u = -au + b]^n
\thinspace .
\end{equation}
$$
<p>&nbsp;<br>

The truncation error fulfills

<p>
<p>&nbsp;<br>
$$
\begin{equation}
[D_t^+ \uex + a\uex - b = R]^n
\thinspace .
\end{equation}
$$
<p>&nbsp;<br>

Using \eqref{trunc:fd1:fw},

<p>
<p>&nbsp;<br>
$$ \uex'(t_n) - \frac{1}{2}\uex''(t_n)\Delta t + \Oof{\Delta t^2}
+ a(t_n)\uex(t_n) - b(t_n) = R^n
\thinspace .
$$
<p>&nbsp;<br>

Because of the ODE, \( \uex'(t_n) + a(t_n)\uex(t_n) - b(t_n) =0 \), and

<p>
<p>&nbsp;<br>
$$
\begin{equation}
R^n = -\frac{1}{2}\uex''(t_n)\Delta t + \Oof{\Delta t^2}
\label{trunc:decay:vc:R}
\thinspace .
\end{equation}
$$
<p>&nbsp;<br>

No problems with variable coefficients!

<p>

</section>


<section>

<h3>Exact solutions of the finite difference equations  <a name="___sec29"></a></h3>

<p>

<ul>
 <p><li> One-sided differences: \( \uex''\Delta t \) (lowest order)</li>
 <p><li> Centered differences: \( \uex'''\Delta t^2 \) (lowest order)</li>
 <p><li> Only harmonic and geometric mean involve \( \uex' \) or \( \uex \)</li>
</ul>
<p>

Consequence:

<p>

<ul>
 <p><li> \( \uex(t)=ct+d \) will very often give exact solution
   of the discrete equations (\( R=0 \))!</li>
 <p><li> Ideal for verification</li>
 <p><li> Centered schemes allow quadratic \( \uex \)</li>
</ul>
<p>


</section>


<section>

<h3>Computing truncation errors in nonlinear problems (1) <a name="trunc:decay:gen"></a></h3>

<p>
<p>&nbsp;<br>
$$
\begin{equation}
u'=f(u,t),
\label{trunc:decay:gen:ode}
\end{equation}
$$
<p>&nbsp;<br>

Crank-Nicolson scheme:

<p>
<p>&nbsp;<br>
$$
\begin{equation}
[D_t u'=\overline{f}^{t}]^{n+\frac{1}{2}}\ts
\label{trunc:decay:gen:ode}
\end{equation}
$$
<p>&nbsp;<br>

Truncation error:

<p>
<p>&nbsp;<br>
$$
\begin{equation}
[D_t \uex' - \overline{f}^{t}= R]^{n+\frac{1}{2}}\ts
\label{trunc:decay:gen:ode:CN}
\end{equation}
$$
<p>&nbsp;<br>

Using \eqref{trunc:avg:arith} for the arithmetic mean:

<p>
<p>&nbsp;<br>
$$
\begin{align*}
[\overline{f}^{t}]^{n+\frac{1}{2}} &=
\frac{1}{2}(f(\uex^n,t_n) + f(\uex^{n+1},t_{n+1})),\\ 
& f(\uex^{n+\frac{1}{2}},t_{n+\frac{1}{2}}) +
\frac{1}{8}\uex''(t_{n+\frac{1}{2}})\Delta t^2
+ \Oof{\Delta t^4}\ts
\end{align*}
$$
<p>&nbsp;<br>


<p>

</section>


<section>

<h3>Computing truncation errors in nonlinear problems (2)  <a name="___sec31"></a></h3>

<p>
With \eqref{trunc:fd1:center}, \eqref{trunc:decay:gen:ode:CN} leads to

<p>
<p>&nbsp;<br>
$$
\uex'(t_{n+\frac{1}{2}}) +
\frac{1}{24}\uex'''(t_{n+\frac{1}{2}})\Delta t^2
- f(\uex^{n+\frac{1}{2}},t_{n+\frac{1}{2}}) -
\frac{1}{8}u''(t_{n+\frac{1}{2}})\Delta t^2
+ \Oof{\Delta t^4} = R^{n+\frac{1}{2}}\ts
$$
<p>&nbsp;<br>

Since \( \uex'(t_{n+\frac{1}{2}}) - f(\uex^{n+\frac{1}{2}},t_{n+\frac{1}{2}})=0 \),
the truncation error becomes

<p>
<p>&nbsp;<br>
$$ R^{n+\frac{1}{2}} = (\frac{1}{24}\uex'''(t_{n+\frac{1}{2}})
- \frac{1}{8}u''(t_{n+\frac{1}{2}})) \Delta t^2\ts
$$
<p>&nbsp;<br>

The computational techniques worked well
even for this <em>nonlinear</em> ODE!

<p>

</section>


<section>

<h2>Truncation errors in vibration ODEs <a name="trunc:vib"></a></h2>

<p>

</section>


<section>

<h3>Linear model without damping  <a name="___sec33"></a></h3>

<p>
<p>&nbsp;<br>
$$
\begin{equation}
u''(t) + \omega^2 u(t) = 0,\quad u(0)=I,\ u'(0)=0\ts
\label{trunc:vib:undamped:ode}
\end{equation}
$$
<p>&nbsp;<br>

Centered difference approximation:

<p>
<p>&nbsp;<br>
$$
\begin{equation}
[D_tD_t u + \omega^2u=0]^n
\label{trunc:vib:undamped:scheme}
\thinspace .
\end{equation}
$$
<p>&nbsp;<br>

Truncation error:

<p>
<p>&nbsp;<br>
$$
\begin{equation}
[D_tD_t \uex + \omega^2\uex =R]^n
\thinspace .
\end{equation}
$$
<p>&nbsp;<br>

Use \eqref{trunc:fd2:center} to expand \( [D_t D_t\uex]^n \):

<p>
<p>&nbsp;<br>
$$ [D_tD_t \uex]^n = \uex''(t_n) + \frac{1}{12}\uex''''(t_n)\Delta t^2,$$
<p>&nbsp;<br>

Collect terms: \( \uex''(t) + \omega^2\uex(t)=0 \). Then,

<p>
<p>&nbsp;<br>
$$
\begin{equation}
R^n =  \frac{1}{12}\uex''''(t_n)\Delta t^2 + \Oof{\Delta t^4}
\thinspace .
\end{equation}
$$
<p>&nbsp;<br>


<p>

</section>


<section>

<h3>Computing correction terms  <a name="___sec34"></a></h3>

<p>
Can we add terms to the ODE such that the truncation error
is improved?

<p>
<p>&nbsp;<br>
$$ [D_tD_t \uex + \omega^2\uex =C + R]^n,$$
<p>&nbsp;<br>


<p>
Idea: choose \( C^n \) such that it absorbs the \( \Delta t^2 \) term in \( R^n \),

<p>
<p>&nbsp;<br>
$$ C^n = \frac{1}{12}\uex''''(t_n)\Delta t^2\ts$$
<p>&nbsp;<br>


<p>
Downside: \( u'''' \)

<p>
Remedy: use the ODE \( u''=-\omega^u \) to see that \( u'''' = \omega^4 u \).

<p>
<p>&nbsp;<br>
$$
\begin{equation}
u'' + \omega^2(1 - \frac{1}{12}\omega^2\Delta t^2)u = 0\ts
\label{trunc:vib:undamped:corr:ode}
\end{equation}
$$
<p>&nbsp;<br>

Just apply the standard scheme to this modified ODE:

<p>
<p>&nbsp;<br>
$$ [D_tD_t u + \omega^2(1 - \frac{1}{12}\omega^2\Delta t^2)u=0]^n,$$
<p>&nbsp;<br>

Accuracy is \( \Oof{\Delta t^4} \).

<p>

</section>


<section>

<h3>Model with damping and nonlinearity <a name="trunc:vib:gen"></a></h3>

<p>
Linear damping \( \beta u' \), nonlinear spring force \( s(u) \), and excitation \( F \):

<p>
<p>&nbsp;<br>
$$
\begin{equation}
mu'' + \beta u' + s(u) =F(t)\ts
\label{trunc:vib:gen:ode1}
\end{equation}
$$
<p>&nbsp;<br>

Central difference discretization:

<p>
<p>&nbsp;<br>
$$
\begin{equation}
[mD_tD_t u + \beta D_{2t} u + s(u)=F]^n
\thinspace .
\end{equation}
$$
<p>&nbsp;<br>

Truncation error is defined by

<p>
<p>&nbsp;<br>
$$
\begin{equation}
[mD_tD_t \uex + \beta D_{2t} \uex + s(\uex)=F + R]^n
\thinspace .
\end{equation}
$$
<p>&nbsp;<br>


<p>

</section>


<section>

<h3>Model with damping and nonlinearity: truncation error analysis  <a name="___sec36"></a></h3>

<p>
Using \eqref{trunc:fd2:center} and \eqref{trunc:fd1:center2} we
get

<p>
<p>&nbsp;<br>
$$
\begin{align*}
[mD_tD_t \uex + \beta D_{2t} \uex]^n &=
m\uex''(t_n) + \beta\uex'(t_n) + \\ 
&\quad \left(\frac{m}{12}\uex''''(t_n) +
  \frac{\beta}{6}\uex'''(t_n)\right)\Delta t^2 + \Oof{\Delta t^4}
\end{align*}
$$
<p>&nbsp;<br>

The terms
<p>&nbsp;<br>
$$ m\uex''(t_n) + \beta\uex'(t_n) + \omega^2\uex(t_n) + s(\uex(t_n)) - F^n,$$
<p>&nbsp;<br>

correspond to the ODE (= zero).

<p>
Result: accuracy of \( \Oof{\Delta t^2} \) since
<p>&nbsp;<br>
$$
\begin{equation}
R^n = \left(\frac{m}{12}\uex''''(t_n) +
  \frac{\beta}{6}\uex'''(t_n)\right)\Delta t^2 + \Oof{\Delta t^4},
\label{trunc:vib:gen:R}
\end{equation}
$$
<p>&nbsp;<br>


<p>
Correction terms: complicated when the ODE has many terms...

<p>

</section>


<section>

<h3>Extension to quadratic damping  <a name="___sec37"></a></h3>

<p>
<p>&nbsp;<br>
$$
\begin{equation}
mu'' + \beta |u'|u' + s(u) =F(t)\ts
\label{trunc:vib:gen:ode2}
\end{equation}
$$
<p>&nbsp;<br>

Centered scheme: \( |u'|u' \) gives rise to a nonlinearity.

<p>
Linearization trick: use a geometric mean,

<p>
<p>&nbsp;<br>
$$ [|u'|u']^n \approx |[u']^{n-\frac{1}{2}}|[u']^{n+\frac{1}{2}}\ts$$
<p>&nbsp;<br>


<p>
Scheme:

<p>
<p>&nbsp;<br>
$$
\begin{equation}
[mD_t D_t u]^n + \beta |[D_{t} u]^{n-\frac{1}{2}}|[D_t u]^{n+\frac{1}{2}}
+ s(u^n)=F^n\ts
\end{equation}
$$
<p>&nbsp;<br>


<p>

</section>


<section>

<h3>The truncation error for quadratic damping (1)  <a name="___sec38"></a></h3>

<p>
Definition of \( R^n \):

<p>
<p>&nbsp;<br>
$$
\begin{equation}
[mD_t D_t \uex]^n +
\beta |[D_{t} \uex]^{n-\frac{1}{2}}|[D_t \uex]^{n+\frac{1}{2}}
+ s(\uex^n)-F^n = R^n\ts
\end{equation}
$$
<p>&nbsp;<br>


<p>
Truncation error of the geometric mean, see \eqref{trunc:avg:geom},

<p>
<p>&nbsp;<br>
$$
|[D_{t} \uex]^{n-\frac{1}{2}}|[D_t \uex]^{n+\frac{1}{2}}
= [|D_t\uex|D_t\uex]^n
- \frac{1}{4}u'(t_n)^2\Delta t^2  + \frac{1}{4}u(t_n)u''(t_n)\Delta t^2
+ \Oof{\Delta t^4}\ts
$$
<p>&nbsp;<br>

Using \eqref{trunc:fd1:center} for the \( D_t\uex \) factors results in

<p>
<p>&nbsp;<br>
$$
[|D_t\uex|D_t\uex]^n = |\uex' + \frac{1}{24}\uex'''(t_n)\Delta t^2 +
\Oof{\Delta t^4}|(\uex' + \frac{1}{24}\uex'''(t_n)\Delta t^2 +
\Oof{\Delta t^4})$$
<p>&nbsp;<br>


<p>

</section>


<section>

<h3>The truncation error for quadratic damping (2)  <a name="___sec39"></a></h3>

<p>
For simplicity, remove the absolute value. Computing the product leads to

<p>
<p>&nbsp;<br>
$$
[D_t\uex D_t\uex]^n = (\uex'(t_n))^2 +
\frac{1}{12}\uex(t_n)\uex'''(t_n)\Delta t^2 +
\Oof{\Delta t^4}\ts$$
<p>&nbsp;<br>


<p>
With

<p>
<p>&nbsp;<br>
$$ m[D_t D_t\uex]^n = m\uex''(t_n) + \frac{m}{12}\uex''''(t_n)\Delta t^2
+\Oof{\Delta t^4},$$
<p>&nbsp;<br>

and using \( mu'' + \beta (u')^2 + s(u)=F \), we end up with

<p>
<p>&nbsp;<br>
$$ R^n = (\frac{m}{12}\uex''''(t_n) +
\frac{\beta}{12}\uex(t_n)\uex'''(t_n))
\Delta t^2 + \Oof{\Delta t^4}\ts$$
<p>&nbsp;<br>

Second-order accuracy! But why?

<p>

<ul>
 <p><li> Difference approximation with truncation error \( \Oof{\Delta t^2} \)</li>
 <p><li> Geometric mean approximation with truncation error \( \Oof{\Delta t^2} \)</li>
</ul>
<p>


</section>


<section>

<h3>The general model formulated as first-order ODEs <a name="trunc:vib:gen:staggered"></a></h3>

<p>
<p>&nbsp;<br>
$$
\begin{equation}
mu'' + \beta |u'|u' + s(u) =F(t)\ts
\label{trunc:vib:gen:ode2}
\end{equation}
$$
<p>&nbsp;<br>

Rewritten as first-order system:

<p>
<p>&nbsp;<br>
$$
\begin{align}
u' &= v,
\label{trunc:vib:gen:2x2model:ode:u} \\ 
v' &= \frac{1}{m}\left( F(t) - \beta |v|v - s(u)\right)\ts
\label{trunc:vib:gen:2x2model:ode:v}
\end{align}
$$
<p>&nbsp;<br>


<p>
To solution methods:

<p>

<ul>
 <p><li> Forward-backward scheme</li>
 <p><li> Centered scheme on a staggered mesh</li>
</ul>
<p>


</section>


<section>

<h3>The forward-backward scheme  <a name="___sec41"></a></h3>

<p>
Forward step for \( u \), backward step for \( v \):

<p>
<p>&nbsp;<br>
$$
\begin{align}
[D_t^+ u &= v]^n,
\label{trunc:vib:gen:2x2model:ode:u:fw} \\ 
[D_t^-v &= \frac{1}{m}( F(t) - \beta |v|v - s(u))]^{n+1}\ts
\label{trunc:vib:gen:2x2model:ode:v:bw}
\end{align}
$$
<p>&nbsp;<br>


<p>

<ul>
 <p><li> Note:</li>

<ul>
   <p><li> step \( u \) forward with known \( v \) in \eqref{trunc:vib:gen:2x2model:ode:u:fw}</li>
   <p><li> step \( v \) forward with known \( u \) in \eqref{trunc:vib:gen:2x2model:ode:v:bw}</li>
</ul>
<p>

 <p><li> Problem: \( |v|v \) gives nonlinearity \( |v^{n+1}|v^{n+1} \).</li>
 <p><li> Remedy: linearized as \( |v^{n}|v^{n+1} \)</li>
</ul>
<p>

<p>&nbsp;<br>
$$
\begin{align}
[D_t^+ u &= v]^n,
\label{trunc:vib:gen:2x2model:ode:u:fw2} \\ 
[D_t^-v]^{n+1} &= \frac{1}{m}( F(t_{n+1}) - \beta |v^n|v^{n+1} - s(u^{n+1}))\ts
\label{trunc:vib:gen:2x2model:ode:v:bw2}
\end{align}
$$
<p>&nbsp;<br>


<p>

</section>


<section>

<h3>Truncation error analysis  <a name="___sec42"></a></h3>

<p>

<ul>
 <p><li> Aim (as always): turn difference operators into derivatives +
   truncation error terms</li>
 <p><li> One-sided forward/backward differences: truncation error \( \Oof{\Delta t} \)</li>
 <p><li> Linearization of \( |v^{n+1}|v^{n+1} \) to \( |v^n|v^{n+1} \):
   truncation error \( \Oof{\Delta t} \)</li>
 <p><li> All errors are \( \Oof{\Delta t} \)</li>
 <p><li> First-order scheme? No!</li>
 <p><li> "Symmetric" use of the \( \Oof{\Delta t} \) building blocks
   yields in fact a \( \Oof{\Delta t^2} \) scheme (!)</li>
 <p><li> Why? See next slide...</li>
</ul>
<p>


</section>


<section>

<h4>A centered scheme on a staggered mesh  <a name="___sec43"></a></h4>

<p>
Staggered mesh:

<p>

<ul>
 <p><li> \( u \) is computed at mesh points \( t_n \)</li>
 <p><li> \( v \) is computed at points \( t_{n+\frac{1}{2}} \)</li>
</ul>
<p>

Centered differences in \eqref{trunc:vib:gen:2x2model:ode:u}-\eqref{trunc:vib:gen:2x2model:ode:u}:

<p>
<p>&nbsp;<br>
$$
\begin{align}
[D_t u &= v]^{n-\frac{1}{2}},
\label{trunc:vib:gen:2x2model:ode:u:staggered} \\ 
[D_t v &= \frac{1}{m}( F(t) - \beta |v|v - s(u))]^{n}\ts
\label{trunc:vib:gen:2x2model:ode:v:staggered}
\end{align}
$$
<p>&nbsp;<br>


<p>

<ul>
 <p><li> Problem: \( |v^n|v^n \), because \( v^n \) is not computed directly</li>
 <p><li> Remedy: Geometric mean,</li>
</ul>
<p>

<p>&nbsp;<br>
$$ |v^n|v^n \approx |v^{n-\frac{1}{2}}|v^{n+\frac{1}{2}}\ts$$
<p>&nbsp;<br>


<p>
Resulting scheme:
<p>&nbsp;<br>
$$
\begin{align}
[D_t u]^{n-\frac{1}{2}} &= v^{n-\frac{1}{2}},
\label{trunc:vib:gen:2x2model:ode:u:staggered2} \\ 
[D_t v]^n &= \frac{1}{m}( F(t_n) -
\beta |v^{n-\frac{1}{2}}|v^{n+\frac{1}{2}} - s(u^n))\ts
\label{trunc:vib:gen:2x2model:ode:v:staggered2}
\end{align}
$$
<p>&nbsp;<br>


<p>

</section>


<section>

<h4>A centered scheme on a staggered mesh: truncation error analysis  <a name="___sec44"></a></h4>

<p>
The truncation error in each equation fulfills

<p>
<p>&nbsp;<br>
$$
\begin{align*}
[D_t \uex]^{n-\frac{1}{2}} &= \vex(t_{n-\frac{1}{2}}) + R_u^{n-\frac{1}{2}},\\ 
[D_t \vex]^n &= \frac{1}{m}( F(t_n) -
\beta |\vex(t_{n-\frac{1}{2}})|\vex(t_{n+\frac{1}{2}}) - s(u^n)) + R_v^n\ts
\end{align*}
$$
<p>&nbsp;<br>

Using \eqref{trunc:fd1:center} for derivatives and \eqref{trunc:avg:geom}
for the geometric mean:

<p>
<p>&nbsp;<br>
$$
\uex'(t_{n-\frac{1}{2}}) +
\frac{1}{24}\uex'''(t_{n-\frac{1}{2}})\Delta t^2 + \Oof{\Delta t^4}
= \vex(t_{n-\frac{1}{2}}) + R_u^{n-\frac{1}{2}},$$
<p>&nbsp;<br>

and
<p>&nbsp;<br>
$$
\vex'(t_n) =
\frac{1}{m}( F(t_n) -
\beta |\vex(t_n)|\vex(t_n) + \Oof{\Delta t^2} - s(u^n)) + R_v^n\ts
$$
<p>&nbsp;<br>

Resulting truncation error is \( \Oof{\Delta t^2} \):

<p>
<p>&nbsp;<br>
$$ R_u^{n-\frac{1}{2}}= \Oof{\Delta t^2}, \quad R_v^n = \Oof{\Delta t^2}\ts$$
<p>&nbsp;<br>


<p>
<div class="alert alert-block alert-warning alert-text-normal"><b>Observation.</b>

<p>
Comparing
The schemes \eqref{trunc:vib:gen:2x2model:ode:u:staggered2}-\eqref{trunc:vib:gen:2x2model:ode:v:staggered2} and
\eqref{trunc:vib:gen:2x2model:ode:u:fw2}-\eqref{trunc:vib:gen:2x2model:ode:v:bw2}
are equivalent. Therefore, the forward/backward scheme with ad hoc
linearization is also \( \Oof{\Delta t^2} \)!
</div>
<p>
<!-- Wave equations... -->


</section>



</div> <!-- class="slides" -->
</div> <!-- class="reveal" -->

<script src="reveal.js/lib/js/head.min.js"></script>
<script src="reveal.js/js/reveal.min.js"></script>

<script>

// Full list of configuration options available here:
// https://github.com/hakimel/reveal.js#configuration
Reveal.initialize({
controls: true,
progress: true,
history: true,
center: true,
heme: Reveal.getQueryHash().theme, // available themes are in reveal.js/css/theme
transition: Reveal.getQueryHash().transition || 'default', // default/cube/page/concave/zoom/linear/none

// Optional libraries used to extend on reveal.js
dependencies: [
{ src: 'reveal.js/lib/js/classList.js', condition: function() { return !document.body.classList; } },
{ src: 'reveal.js/plugin/markdown/showdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
{ src: 'reveal.js/plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
{ src: 'reveal.js/plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
{ src: 'reveal.js/plugin/zoom-js/zoom.js', async: true, condition: function() { return !!document.body.classList; } },
{ src: 'reveal.js/plugin/notes/notes.js', async: true, condition: function() { return !!document.body.classList; } }
// { src: 'reveal.js/plugin/remotes/remotes.js', async: true, condition: function() { return !!document.body.classList; } }
]
});
</script>


</body>
</html>
