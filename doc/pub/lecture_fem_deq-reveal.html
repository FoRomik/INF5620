<!DOCTYPE html>

<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="Doconce: https://github.com/hplgit/doconce/" />
<meta name="description" content="Study Guide: Solving differential equations with finite elements">
<meta name="keywords" content="trial function,test function,trial space,test space,integration by parts">







<!-- reveal.js: http://lab.hakim.se/reveal-js/ -->

<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

<link rel="stylesheet" href="reveal.js/css/reveal.css">
<link rel="stylesheet" href="reveal.js/css/theme/darkgray.css" id="theme">
<!--
<link rel="stylesheet" href="reveal.js/css/reveal.css">
<link rel="stylesheet" href="reveal.js/css/reveal.min.css">
<link rel="stylesheet" href="reveal.js/css/theme/beige.css" id="theme">
<link rel="stylesheet" href="reveal.js/css/theme/beigesmall.css" id="theme">
<link rel="stylesheet" href="reveal.js/css/theme/night.css" id="theme">
<link rel="stylesheet" href="reveal.js/css/theme/simple.css" id="theme">
<link rel="stylesheet" href="reveal.js/css/theme/sky.css" id="theme">
<link rel="stylesheet" href="reveal.js/css/theme/darkgray.css" id="theme">
-->

<script>
document.write( '<link rel="stylesheet" href="reveal.js/css/print/' + ( window.location.search.match( /print-pdf/gi ) ? 'pdf' : 'paper' ) + '.css" type="text/css" media="print">' );
</script>

<style type="text/css">
    hr { border: 0; width: 80%; border-bottom: 1px solid #aaa}
    p.caption { width: 80%; font-size: 60%; font-style: italic; text-align: left; }
    hr.figure { border: 0; width: 80%; border-bottom: 1px solid #aaa}
    .reveal .alert-text-small   { font-size: 80%;  }
    .reveal .alert-text-large   { font-size: 130%; }
    .reveal .alert-text-normal  { font-size: 90%;  }
    .reveal .alert {
             padding:8px 35px 8px 14px; margin-bottom:18px;
             text-shadow:0 1px 0 rgba(255,255,255,0.5);
             border:5px solid #bababa;
             -webkit-border-radius: 14px; -moz-border-radius: 14px;
             border-radius:14px
             background-position: 10px 10px;
             background-repeat: no-repeat;
             background-size: 38px;
             padding-left: 30px; /* 55px; if icon */
     }
     .reveal .alert-block {padding-top:14px; padding-bottom:14px}
     .reveal .alert-block > p, .alert-block > ul {margin-bottom:1em}
     /*.reveal .alert li {margin-top: 1em}*/
     .reveal .alert-block p+p {margin-top:5px}
     /*.reveal .alert-notice { background-image: url(http://hplgit.github.io/doconce/bundled/html_images/small_gray_notice.png); }
     .reveal .alert-summary  { background-image:url(http://hplgit.github.io/doconce/bundled/html_images/small_gray_summary.png); }
     .reveal .alert-warning { background-image: url(http://hplgit.github.io/doconce/bundled/html_images/small_gray_warning.png); }
     .reveal .alert-question {background-image:url(http://hplgit.github.io/doconce/bundled/html_images/small_gray_question.png); } */

</style>



<!-- Styles for table layout of slides -->
<style type="text/css">
td.padding {
  padding-top:20px;
  padding-bottom:20px;
  padding-right:50px;
  padding-left:50px;
}
</style>

</head>

<body>
<div class="reveal">

<!-- Any section element inside the <div class="slides"> container
     is displayed as a slide -->

<div class="slides">





<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  TeX: {
     equationNumbers: {  autoNumber: "none"  },
     extensions: ["AMSmath.js", "AMSsymbols.js", "autobold.js"]
  }
});
</script>
<script type="text/javascript"
 src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
<!-- Fix slow MathJax rendering in IE8 -->
<meta http-equiv="X-UA-Compatible" content="IE=EmulateIE7">


<!-- newcommands_keep.tex -->
$$
\newcommand{\uex}{{u_{\small\mbox{e}}}}
\newcommand{\uexd}[1]{{u_{\small\mbox{e}, #1}}}
\newcommand{\vex}{{v_{\small\mbox{e}}}}
\newcommand{\vexd}[1]{{v_{\small\mbox{e}, #1}}}
\newcommand{\Aex}{{A_{\small\mbox{e}}}}
\newcommand{\half}{\frac{1}{2}}
\newcommand{\halfi}{{1/2}}
\newcommand{\tp}{\thinspace .}

\newcommand{\Ddt}[1]{\frac{D #1}{dt}}
\newcommand{\E}[1]{\hbox{E}\lbrack #1 \rbrack}
\newcommand{\Var}[1]{\hbox{Var}\lbrack #1 \rbrack}
\newcommand{\Std}[1]{\hbox{Std}\lbrack #1 \rbrack}

\newcommand{\xpoint}{\boldsymbol{x}}
\newcommand{\normalvec}{\boldsymbol{n}}
\newcommand{\Oof}[1]{\mathcal{O}(#1)}

\newcommand{\x}{\boldsymbol{x}}
\newcommand{\X}{\boldsymbol{X}}
\renewcommand{\u}{\boldsymbol{u}}
\renewcommand{\v}{\boldsymbol{v}}
\newcommand{\w}{\boldsymbol{w}}
\newcommand{\V}{\boldsymbol{V}}
\newcommand{\e}{\boldsymbol{e}}
\newcommand{\f}{\boldsymbol{f}}
\newcommand{\F}{\boldsymbol{F}}
\newcommand{\stress}{\boldsymbol{\sigma}}
\newcommand{\strain}{\boldsymbol{\varepsilon}}
\newcommand{\stressc}{{\sigma}}
\newcommand{\strainc}{{\varepsilon}}
\newcommand{\I}{\boldsymbol{I}}
\newcommand{\T}{\boldsymbol{T}}

\newcommand{\dfc}{\alpha}  % diffusion coefficient
\newcommand{\ii}{\boldsymbol{i}}
\newcommand{\jj}{\boldsymbol{j}}
\newcommand{\kk}{\boldsymbol{k}}
\newcommand{\ir}{\boldsymbol{i}_r}
\newcommand{\ith}{\boldsymbol{i}_{\theta}}
\newcommand{\iz}{\boldsymbol{i}_z}

\newcommand{\Ix}{{I_x}}
\newcommand{\Iy}{{I_y}}
\newcommand{\Iz}{{I_z}}
\newcommand{\It}{{I_t}}
\newcommand{\If}{{I}}     % for FEM
\newcommand{\Ifd}{{I_d}}  % for FEM
\newcommand{\Ifb}{{I_b}}  % for FEM
\newcommand{\setb}[1]{#1^0}    % set begin
\newcommand{\sete}[1]{#1^{-1}} % set end
\newcommand{\setl}[1]{#1^-}
\newcommand{\setr}[1]{#1^+}
\newcommand{\seti}[1]{#1^i}
\newcommand{\sequencei}[1]{\left\{ {#1}_i \right\}_{i\in\If}}

\newcommand{\basphi}{\varphi}
\newcommand{\baspsi}{\psi}
\newcommand{\refphi}{\tilde\basphi}
\newcommand{\psib}{\boldsymbol{\psi}}
\newcommand{\sinL}[1]{\sin\left((#1+1)\pi\frac{x}{L}\right)}
\newcommand{\xno}[1]{x_{#1}}
\newcommand{\Xno}[1]{X_{(#1)}}
\newcommand{\yno}[1]{y_{#1}}
\newcommand{\Yno}[1]{Y_{(#1)}}
\newcommand{\xdno}[1]{\boldsymbol{x}_{#1}}

\newcommand{\dX}{\, \mathrm{d}X}
\newcommand{\dx}{\, \mathrm{d}x}
\newcommand{\ds}{\, \mathrm{d}s}
\newcommand{\Real}{\mathbb{R}}
\newcommand{\Integerp}{\mathbb{N}}
\newcommand{\Integer}{\mathbb{Z}}
$$




    



<section>
<!-- ------------------- main content ---------------------- -->


<title>Study Guide: Solving differential equations with finite elements</title>

<center><h1>Study Guide: Solving differential equations with finite elements</h1></center>  <!-- document title -->

<p>
<!-- author(s): Hans Petter Langtangen -->

<center>
<b>Hans Petter Langtangen</b> [1, 2]
</center>


<p>&nbsp;<br>
<!-- institution(s) -->

<center>[1] <b>Center for Biomedical Computing, Simula Research Laboratory</b></center>
<center>[2] <b>Department of Informatics, University of Oslo</b></center>
<p>&nbsp;<br>
<center><h4>Oct 30, 2013</h4></center> <!-- date -->
<p>

</section>


<section>

<h2>Differential equation models <a name="fem:deq:1D:models"></a></h2>

<p>
Our aim is to extend the ideas for approximating \( f \) by \( u \), or solving

<p>
<p>&nbsp;<br>
$$ u = f $$
<p>&nbsp;<br>


<p>
to real differential equations like

<p>
<p>&nbsp;<br>
$$ -u'' + bu = f,\quad u(0)=1,\ u'(L)=D $$
<p>&nbsp;<br>


<p>
Three methods are addressed:

<p>

<ol>
<p><li> least squares</li>
<p><li> Galerkin/projection</li>
<p><li> collocation (interpolation)</li>
</ol>
<p>

Method 2 will be totally dominating!

<p>

</section>


<section>

<h3>Abstract differential equation  <a name="___sec1"></a></h3>

<p>
<p>&nbsp;<br>
$$
\begin{equation}
\mathcal{L}(u) = 0,\quad x\in\Omega  \end{equation}
$$
<p>&nbsp;<br>


<p>
Examples (1D problems):

<p>
<p>&nbsp;<br>
$$
\begin{align}
\mathcal{L}(u) &= \frac{d^2u}{dx^2} - f(x),
\tag{1}\\ 
\mathcal{L}(u) &= \frac{d}{dx}\left(\dfc(x)\frac{du}{dx}\right) + f(x),
\tag{2}\\ 
\mathcal{L}(u) &= \frac{d}{dx}\left(\dfc(u)\frac{du}{dx}\right) - au + f(x),
\tag{3}\\ 
\mathcal{L}(u) &= \frac{d}{dx}\left(\dfc(u)\frac{du}{dx}\right) + f(u,x)
\tag{4}
\end{align}
$$
<p>&nbsp;<br>


<p>

</section>


<section>

<h3>Abstract boundary conditions  <a name="___sec2"></a></h3>

<p>
<p>&nbsp;<br>
$$
\begin{equation}
{\cal B}_0(u)=0,\ x=0,\quad {\cal B}_1(u)=0,\ x=L
\end{equation}
$$
<p>&nbsp;<br>


<p>
Examples:

<p>
<p>&nbsp;<br>
$$
\begin{align}
\mathcal{B}_i(u) &= u - g,\quad &\hbox{Dirichlet condition}\\ 
\mathcal{B}_i(u) &= -\dfc \frac{du}{dx} - g,\quad &\hbox{Neumann condition}\\ 
\mathcal{B}_i(u) &= -\dfc \frac{du}{dx} - h(u-g),\quad &\hbox{Robin condition}
\end{align}
$$
<p>&nbsp;<br>


<p>

</section>


<section>

<h3>Reminder about notation  <a name="___sec3"></a></h3>

<p>

<ul>
 <p><li> \( \uex(x) \) is the symbol for the <em>exact</em> solution
   of \( \mathcal{L}(\uex)=0 \)</li>
 <p><li> \( u(x) \) denotes an <em>approximate</em> solution</li>
 <p><li> We seek \( u\in V \)</li>
 <p><li> \( V = \hbox{span}\{ \baspsi_0(x),\ldots,\baspsi_N(x)\} \), \( V \) has basis \( \sequencei{\baspsi} \)</li>
 <p><li> \( \If =\{0,\ldots,N\} \) is an index set</li>
 <p><li> \( u(x) = \sum_{j\in\If} c_j\baspsi_j(x) \)</li>
 <p><li> Inner product: \( (u,v) = \int_\Omega uv\dx \)</li>
 <p><li> Norm: \( ||u||=\sqrt{(u,u)} \)</li>
</ul>
<p>


</section>


<section>

<h3>New topics  <a name="___sec4"></a></h3>

<p>
Much is similar to approximating a function (solving \( u=f \)), but
two new topics are needed:

<p>

<ul>
 <p><li> Variational formulation of the differential equation problem
   (including integration by parts)</li>
 <p><li> Handling of boundary conditions</li>
</ul>
<p>


</section>


<section>

<h3>Residual-minimizing principles <a name="fem:deq:1D:residual:min"></a></h3>

<p>

<ul>
 <p><li> When solving \( u=f \) we knew the error \( e=f-u \) and could
   use principles for minimizing the error</li>
 <p><li> When solving \( \mathcal{L}(\uex)=0 \) we do not know \( \uex \) and
   cannot work with the error \( e=\uex - u \)</li>
 <p><li> We only have the <em>error in the equation</em>: the residual \( R \)</li>
</ul>
<p>

Inserting \( u=\sum_jc_j\baspsi_j \) in \( \mathcal{L}=0 \) gives
a residual

<p>
<p>&nbsp;<br>
$$
\begin{equation}
R = \mathcal{L}(u) = \mathcal{L}(\sum_j c_j \baspsi_j) \neq 0
\end{equation}
$$
<p>&nbsp;<br>


<p>
Goal: minimize \( R \) wrt \( \sequencei{c} \) (and hope it makes a small \( e \) too)

<p>
<p>&nbsp;<br>
$$ R=R(c_0,\ldots,c_N; x)$$
<p>&nbsp;<br>


<p>

</section>


<section>

<h3>The least squares method  <a name="___sec6"></a></h3>

<p>
Idea: minimize

<p>
<p>&nbsp;<br>
$$
\begin{equation}
E = ||R||^2 = (R,R) = \int_{\Omega} R^2 dx
\end{equation}
$$
<p>&nbsp;<br>


<p>
Minimization wrt \( \sequencei{c} \) implies

<p>
<p>&nbsp;<br>
$$
\begin{equation}
\frac{\partial E}{\partial c_i} =
\int_{\Omega} 2R\frac{\partial R}{\partial c_i} dx = 0\quad
\Leftrightarrow\quad (R,\frac{\partial R}{\partial c_i})=0,\quad
i\in\If
\tag{5}
\end{equation}
$$
<p>&nbsp;<br>


<p>
\( N+1 \) equations for \( N+1 \) unknowns \( \sequencei{c} \)

<p>

</section>


<section>

<h3>The Galerkin method  <a name="___sec7"></a></h3>

<p>
Idea: make \( R \) orthogonal to \( V \),

<p>
<p>&nbsp;<br>
$$
\begin{equation}
(R,v)=0,\quad \forall v\in V
\tag{6}
\end{equation}
$$
<p>&nbsp;<br>


<p>
This implies

<p>
<p>&nbsp;<br>
$$
\begin{equation}
(R,\baspsi_i)=0,\quad i\in\If
\tag{7}
\end{equation}
$$
<p>&nbsp;<br>


<p>
\( N+1 \) equations for \( N+1 \) unknowns \( \sequencei{c} \)

<p>

</section>


<section>

<h3>The Method of Weighted Residuals  <a name="___sec8"></a></h3>

<p>
Generalization of the Galerkin method: demand \( R \)
orthogonal to some space \( W \), possibly \( W\neq V \):

<p>
<p>&nbsp;<br>
$$
\begin{equation}
(R,v)=0,\quad \forall v\in W
\tag{8}
\end{equation}
$$
<p>&nbsp;<br>


<p>
If \( \{w_0,\ldots,w_N\} \) is a basis for \( W \):

<p>
<p>&nbsp;<br>
$$
\begin{equation}
(R,w_i)=0,\quad i\in\If
\tag{9}
\end{equation}
$$
<p>&nbsp;<br>


<p>

<ul>
 <p><li> \( N+1 \) equations for \( N+1 \) unknowns \( \sequencei{c} \)</li>
 <p><li> Weighted residual with \( w_i = \partial R/\partial c_i \) gives
   least squares</li>
</ul>
<p>


</section>


<section>

<h3>Terminology: test and trial Functions  <a name="___sec9"></a></h3>

<p>

<ul>
 <p><li> \( \baspsi_j \) used in \( \sum_jc_j\baspsi_j \) is called <em>trial function</em></li>
 <p><li> \( \baspsi_i \) or \( w_i \) used as weight in Galerkin's method is called <em>test function</em></li>
</ul>
<p>


</section>


<section>

<h3>The collocation method  <a name="___sec10"></a></h3>

<p>
Idea: demand \( R=0 \) at \( N+1 \) points

<p>
<p>&nbsp;<br>
$$
\begin{equation}
R(\xno{i}; c_0,\ldots,c_N)=0,\quad i\in\If
\tag{10}
\end{equation}
$$
<p>&nbsp;<br>


<p>
Note: The collocation method is a weighted residual method with
delta functions as weights

<p>
<p>&nbsp;<br>
$$ 0 = \int_\Omega R(x;c_0,\ldots,c_N)
\delta(x-\xno{i})\dx = R(\xno{i}; c_0,\ldots,c_N)$$
<p>&nbsp;<br>


<p>
<p>&nbsp;<br>
$$
\begin{equation}
\hbox{property of } \delta(x):\quad
\int_{\Omega} f(x)\delta (x-\xno{i}) dx = f(\xno{i}),\quad \xno{i}\in\Omega
\tag{11}
\end{equation}
$$
<p>&nbsp;<br>


<p>
<center><p><img src="fig-fem/delta_func_weight.png" align="bottom" width=200></p></center>

<p>

</section>


<section>

<h2>Examples on using the principles <a name="fem:deq:1D:ex:sines"></a></h2>

<p>
<div class="alert alert-block alert-block alert-text-normal"><b>Goal.</b>
Exemplify the least squares, Galerkin, and collocation methods
in a simple 1D problem with global basis functions.
</div>
<p>

</section>


<section>

<h3>The first model problem  <a name="___sec12"></a></h3>

<p>
<p>&nbsp;<br>
$$
\begin{equation}
-u''(x) = f(x),\quad x\in\Omega=[0,L],\quad u(0)=0,\ u(L)=0
\tag{12}
\end{equation}
$$
<p>&nbsp;<br>


<p>
Basis functions:

<p>
<p>&nbsp;<br>
$$
\begin{equation}
\baspsi_i(x) = \sinL{i},\quad i\in\If
\tag{13}
\end{equation}
$$
<p>&nbsp;<br>


<p>
The residual:

<p>
<p>&nbsp;<br>
$$
\begin{align}
R(x;c_0,\ldots,c_N) &= u''(x) + f(x),\nonumber\\ 
&= \frac{d^2}{dx^2}\left(\sum_{j\in\If} c_j\baspsi_j(x)\right)
+ f(x),\nonumber\\ 
&= -\sum_{j\in\If} c_j\baspsi_j''(x) + f(x)
\tag{14}
\end{align}
$$
<p>&nbsp;<br>


<p>

</section>


<section>

<h3>Boundary conditions  <a name="___sec13"></a></h3>

<p>
Since \( u(0)=u(L)=0 \) we must ensure that
all \( \baspsi_i(0)=\baspsi_i(L)=0 \). Then

<p>
<p>&nbsp;<br>
$$ u(0) = \sum_jc_j\baspsi_j(0) = 0,\quad u(L) = \sum_jc_j\baspsi_j(L) $$
<p>&nbsp;<br>


<p>

<ul>
 <p><li> \( u \) known: Dirichlet boundary condition</li>
 <p><li> \( u' \) known: Neumann boundary condition</li>
 <p><li> Must have \( \baspsi_i=0 \) where Dirichlet conditions apply</li>
</ul>
<p>


</section>


<section>

<h3>The least squares method; principle  <a name="___sec14"></a></h3>

<p>
<p>&nbsp;<br>
$$
(R,\frac{\partial R}{\partial c_i}) = 0,\quad i\in\If
$$
<p>&nbsp;<br>


<p>
<p>&nbsp;<br>
$$
\begin{equation}
\frac{\partial R}{\partial c_i} =
\frac{\partial}{\partial c_i}
\left(\sum_{j\in\If} c_j\baspsi_j''(x) + f(x)\right)
= \baspsi_i''(x)  \end{equation}
$$
<p>&nbsp;<br>


<p>
Because:
<p>&nbsp;<br>
$$
\frac{\partial}{\partial c_i}\left(c_0\baspsi_0'' + c_1\baspsi_1'' + \cdots +
c_{i-1}\baspsi_{i-1}'' + \color{blue}{c_i\baspsi_{i}''} + c_{i+1}\baspsi_{i+1}''
+ \cdots + c_N\baspsi_N'' \right) = \baspsi_{i}''
$$
<p>&nbsp;<br>


<p>

</section>


<section>

<h3>The least squares method; equation system  <a name="___sec15"></a></h3>

<p>
<p>&nbsp;<br>
$$
\begin{equation}
(\sum_j c_j \baspsi_j'' + f,\baspsi_i'')=0,\quad i\in\If
\end{equation}
$$
<p>&nbsp;<br>


<p>
Rearrangement:

<p>
<p>&nbsp;<br>
$$
\begin{equation}
\sum_{j\in\If}(\baspsi_i'',\baspsi_j'')c_j = -(f,\baspsi_i''),\quad i\in\If  \end{equation}
$$
<p>&nbsp;<br>


<p>
This is a linear system

<p>
<p>&nbsp;<br>
$$
\begin{equation*} \sum_{j\in\If}A_{i,j}c_j = b_i,\quad i\in\If
\end{equation*}
$$
<p>&nbsp;<br>

with

<p>
<p>&nbsp;<br>
$$
\begin{align}
A_{i,j} &= (\baspsi_i'',\baspsi_j'')\nonumber\\ 
& = \pi^4(i+1)^2(j+1)^2L^{-4}\int_0^L \sinL{i}\sinL{j}\, dx\nonumber\\ 
&= \left\lbrace
\begin{array}{ll} {1\over2}L^{-3}\pi^4(i+1)^4 & i=j  \\ 0, & i\neq j
\end{array}\right.
\\ 
b_i &= -(f,\baspsi_i'') = (i+1)^2\pi^2L^{-2}\int_0^Lf(x)\sinL{i}\, dx
\end{align}
$$
<p>&nbsp;<br>


<p>

</section>


<section>

<h3>Orthogonality of the basis functions gives diagonal matrix  <a name="___sec16"></a></h3>

<p>
Useful property:

<p>
<p>&nbsp;<br>
$$
\begin{equation}
\int\limits_0^L \sinL{i}\sinL{j}\, dx = \delta{ij},\quad
\quad\delta_{ij} = \left\lbrace
\begin{array}{ll} \half L & i=j  \\ 0, & i\neq j
\end{array}\right.
\end{equation}
$$
<p>&nbsp;<br>


<p>
\( \Rightarrow\ (\baspsi_i'',\baspsi_j'') = \delta_{ij} \), i.e.,
diagonal \( A_{i,j} \), and we can easily solve for \( c_i \):

<p>
<p>&nbsp;<br>
$$
\begin{equation}
c_i = \frac{2L}{\pi^2(i+1)^2}\int_0^Lf(x)\sinL{i}\, dx
\tag{15}
\end{equation}
$$
<p>&nbsp;<br>


<p>

</section>


<section>

<h3>Least squares method; solution  <a name="___sec17"></a></h3>

<p>
Let's <code>sympy</code> do the work (\( f(x)=2 \)):

<p>

<!-- code=python (from !bc pycod) typeset with pygments style "native" -->
<div class="highlight" style="background: #202020"><pre style="line-height: 125%"><span style="color: #6ab825; font-weight: bold">from</span> <span style="color: #447fcf; text-decoration: underline">sympy</span> <span style="color: #6ab825; font-weight: bold">import</span> <span style="color: #d0d0d0">*</span>
<span style="color: #6ab825; font-weight: bold">import</span> <span style="color: #447fcf; text-decoration: underline">sys</span>

<span style="color: #d0d0d0">i,</span> <span style="color: #d0d0d0">j</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">symbols(</span><span style="color: #ed9d13">&#39;i j&#39;</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">integer=</span><span style="color: #24909d">True</span><span style="color: #d0d0d0">)</span>
<span style="color: #d0d0d0">x,</span> <span style="color: #d0d0d0">L</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">symbols(</span><span style="color: #ed9d13">&#39;x L&#39;</span><span style="color: #d0d0d0">)</span>
<span style="color: #d0d0d0">f</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">2</span>
<span style="color: #d0d0d0">a</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">2</span><span style="color: #d0d0d0">*L/(pi**</span><span style="color: #3677a9">2</span><span style="color: #d0d0d0">*(i+</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">)**</span><span style="color: #3677a9">2</span><span style="color: #d0d0d0">)</span>
<span style="color: #d0d0d0">c_i</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">a*integrate(f*sin((i+</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">)*pi*x/L),</span> <span style="color: #d0d0d0">(x,</span> <span style="color: #3677a9">0</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">L))</span>
<span style="color: #d0d0d0">c_i</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">simplify(c_i)</span>
<span style="color: #6ab825; font-weight: bold">print</span> <span style="color: #d0d0d0">c_i</span>
</pre></div>
<p>
<p>&nbsp;<br>
$$
\begin{equation}
c_i = 4 \frac{L^{2} \left(\left(-1\right)^{i} + 1\right)}{\pi^{3}
\left(i^{3} + 3 i^{2} + 3 i + 1\right)},\quad
u(x) = \sum_{k=0}^{N/2} \frac{8L^2}{\pi^3(2k+1)^3}\sinL{2k}\tp
\end{equation}
$$
<p>&nbsp;<br>


<p>
Fast decay: \( c_2 = c_0/27 \), \( c_4=c_0/125 \) - only one term might be good enough:

<p>
<p>&nbsp;<br>
$$
\begin{equation*} u(x) \approx \frac{8L^2}{\pi^3}\sin\left(\pi\frac{x}{L}\right)\tp  \end{equation*}
$$
<p>&nbsp;<br>


<p>

</section>


<section>

<h3>The Galerkin method; principle  <a name="___sec18"></a></h3>

<p>
\( R=u''+f \):

<p>
<p>&nbsp;<br>
$$
\begin{equation*}
(u''+f,v)=0,\quad \forall v\in V,
\end{equation*}
$$
<p>&nbsp;<br>

or

<p>
<p>&nbsp;<br>
$$
\begin{equation}
(u'',v) = -(f,v),\quad\forall v\in V  \end{equation}
$$
<p>&nbsp;<br>


<p>
This is a <em>variational formulation</em> of the differential equation problem.

<p>
\( \forall v\in V \) means for all basis functions:

<p>
<p>&nbsp;<br>
$$
\begin{equation}
(\sum_{j\in\If} c_j\baspsi_j'', \baspsi_i)=-(f,\baspsi_i),\quad i\in\If  \end{equation}
$$
<p>&nbsp;<br>


<p>

</section>


<section>

<h3>The Galerkin method; solution  <a name="___sec19"></a></h3>

<p>
Since \( \baspsi_i''\propto \baspsi_i \),
Galerkin's method gives the same linear system and the same solution
as the least squares method (in this particular example).

<p>

</section>


<section>

<h3>The collocation method  <a name="___sec20"></a></h3>

<p>
\( R=0 \) (i.e.,the differential equation) must be satisfied at \( N+1 \) points:

<p>
<p>&nbsp;<br>
$$
\begin{equation}
-\sum_{j\in\If} c_j\baspsi_j''(\xno{i}) = f(\xno{i}),\quad i\in\If
\end{equation}
$$
<p>&nbsp;<br>


<p>
This is a linear system \( \sum_j A_{i,j}=b_i \) with entries

<p>
<p>&nbsp;<br>
$$
\begin{equation*} A_{i,j}=-\baspsi_j''(\xno{i})=
(j+1)^2\pi^2L^{-2}\sin\left((j+1)\pi \frac{x_i}{L}\right),
\quad b_i=2
\end{equation*}
$$
<p>&nbsp;<br>


<p>
Choose: \( N=0 \), \( x_0=L/2 \)

<p>
<p>&nbsp;<br>
$$ c_0=2L^2/\pi^2 $$
<p>&nbsp;<br>


<p>

</section>


<section>

<h3>Comparison of the methods  <a name="___sec21"></a></h3>

<p>

<ul>
 <p><li> Exact solution: \( u(x)=x(L-x) \)</li>
 <p><li> Galerkin or least squares (\( N=0 \)): \( u(x)=8L^2\pi^{-3}\sin (\pi x/L) \)</li>
 <p><li> Collocation method (\( N=0 \)): \( u(x)=2L^2\pi^{-2}\sin (\pi x/L) \).</li>
 <p><li> Max error in Galerkin/least sq.: \( -0.008L^2 \)</li>
 <p><li> Max error in collocation: \( 0.047L^2 \)</li>
</ul>
<p>


</section>


<section>

<h2>Useful techniques  <a name="___sec22"></a></h2>

<p>

</section>


<section>

<h3>Integration by parts <a name="fem:deq:1D:varform"></a></h3>

<p>
Second-order derivatives will hereafter be integrated by parts

<p>
<p>&nbsp;<br>
$$
\begin{align}
\int_0^L u''(x)v(x) dx &= - \int_0^Lu'(x)v'(x)dx
+ [vu']_0^L\nonumber\\ 
&= - \int_0^Lu'(x)v'(x) dx
+ u'(L)v(L) - u'(0)v(0)
\tag{16}
\end{align}
$$
<p>&nbsp;<br>


<p>
Motivation:

<p>

<ul>
 <p><li> Lowers the order of derivatives</li>
 <p><li> Gives more symmetric forms (incl. matrices)</li>
 <p><li> Enables easy handling of Neumann boundary conditions</li>
 <p><li> Finite element basis functions \( \basphi_i \) have discontinuous
   derivatives (at cell boundaries) and are not suited for
   terms with \( \basphi_i'' \)</li>
</ul>
<p>

<h3>Boundary function; principles  <a name="___sec24"></a></h3>
<a name="fem:deq:1D:essBC:Bfunc"></a>

<p>

<ul>
 <p><li> What about nonzero Dirichlet conditions?</li>
 <p><li> E.g. \( u(L)=D \)</li>
 <p><li> Problem: \( u(L) = \sum_j c_j\baspsi_j(L)=0 \) - always</li>
 <p><li> Remedy: \( u(x) = B(x) + \sum_j c_j\baspsi_j(x) \)</li>
 <p><li> Construct \( B \) such that \( B(0)=u(0) \), \( B(L)=u(L) \)</li>
 <p><li> No restrictions of how \( B(x) \) varies in the interior of \( \Omega \)</li>
</ul>
<p>


</section>


<section>

<h3>Boundary function; example  <a name="___sec25"></a></h3>

<p>
\( u(0)=C \) and \( u(L)=D \). Choose

<p>
<p>&nbsp;<br>
$$ B(x) = L^{-1}(C(L-x) + Dx):\qquad B(0)=C,\ B(L)=D  $$
<p>&nbsp;<br>


<p>
<p>&nbsp;<br>
$$
\begin{equation}
u(x) = L^{-1}(C(L-x) + Dx) + \sum_{j\in\If} c_j\baspsi_j(x),
\tag{17}
\end{equation}
$$
<p>&nbsp;<br>


<p>
<p>&nbsp;<br>
$$ u(0) = C,\quad u(L) = 0  $$
<p>&nbsp;<br>


<p>

</section>


<section>

<h3>Abstract notation for variational formulations <a name="fem:deq:1D:varform:abstract"></a></h3>

<p>
The finite element literature (and much FEniCS documentation)
applies an abstract notation for the variational formulation:

<p>
<div class="alert alert-block alert-block alert-text-normal"><b></b>
*Find \( (u-B)\in V \) such that
<p>&nbsp;<br>
$$ a(u,v) = L(v)\quad \forall v\in V $$
<p>&nbsp;<br>
</div>
<p>

</section>


<section>

<h3>Example on abstract notation  <a name="___sec27"></a></h3>

<p>
Given a variational formulation for \( -u''=f \):

<p>
<p>&nbsp;<br>
$$
\int_{\Omega} u' v'dx = \int_{\Omega} fvdx\quad\hbox{or}\quad (u',v') = (f,v)
\quad\forall v\in V
$$
<p>&nbsp;<br>


<p>
Abstract formulation: finn \( (u-B)\in V \) such that

<p>
<p>&nbsp;<br>
$$ a(u,v) = L(v)\quad \forall v\in V$$
<p>&nbsp;<br>


<p>
We identify

<p>
<p>&nbsp;<br>
$$ a(u,v) = (u',v'),\quad L(v) = (f,v)  $$
<p>&nbsp;<br>


<p>

</section>


<section>

<h3>Bilinear and linear forms  <a name="___sec28"></a></h3>

<p>

<ul>
 <p><li> \( a(u,v) \) is a <em>bilinear form</em></li>
 <p><li> \( L(v) \) is a <em>linear form</em></li>
</ul>
<p>

Linear form means

<p>
<p>&nbsp;<br>
$$ L(\alpha_1 v_1 + \alpha_2 v_2)
=\alpha_1 L(v_1) + \alpha_2 L(v_2),
$$
<p>&nbsp;<br>


<p>
Bilinear form means
<p>&nbsp;<br>
$$
\begin{align*}
a(\alpha_1 u_1 + \alpha_2 u_2, v) &= \alpha_1 a(u_1,v) + \alpha_2 a(u_2, v),
\\ 
a(u, \alpha_1 v_1 + \alpha_2 v_2) &= \alpha_1 a(u,v_1) + \alpha_2 a(u, v_2)
\end{align*}
$$
<p>&nbsp;<br>


<p>
In nonlinear problems: Find \( (u-B)\in V \) such that \( F(u;v)=0\ \forall v\in V \)

<p>

</section>


<section>

<h3>The linear system associated with abstract form  <a name="___sec29"></a></h3>

<p>
<p>&nbsp;<br>
$$ a(u,v) = L(v)\quad \forall v\in V$$
<p>&nbsp;<br>


<p>
is equivalent to

<p>
<p>&nbsp;<br>
$$ a(u,\baspsi_i) = L(\baspsi_i)\quad i\in\If$$
<p>&nbsp;<br>


<p>
Insert \( u=\sum_jc_j\baspsi_j \) and use linearity:

<p>
<p>&nbsp;<br>
$$ \sum_{j\in\If} a(\baspsi_j,\baspsi_i)c_j = L(\baspsi_i)\quad i\in\If$$
<p>&nbsp;<br>


<p>
This is a linear system

<p>
<p>&nbsp;<br>
$$ \sum_{j\in\If} A_{i,j}c_j=b_i,\quad i\in\If$$
<p>&nbsp;<br>

with
<p>&nbsp;<br>
$$
\begin{align*}
A_{i,j} &= a(\baspsi_j,\baspsi_i)\\ 
b_i &= L(\baspsi_i)
\end{align*}
$$
<p>&nbsp;<br>


<p>

</section>


<section>

<h3>Equivalence with minimization problem  <a name="___sec30"></a></h3>

<p>
If \( a(u,v)=a(v,u) \),

<p>
<p>&nbsp;<br>
$$ a(u,v)=L(v)\quad\forall v\in V,$$
<p>&nbsp;<br>


<p>
is equivalent to minimizing the functional

<p>
<p>&nbsp;<br>
$$ F(v) = \frac{1}{2}a(v,v) - L(v) $$
<p>&nbsp;<br>

over all functions \( v\in V \). That is,

<p>
<p>&nbsp;<br>
$$ F(u)\leq F(v)\quad \forall v\in V\tp $$
<p>&nbsp;<br>


<p>

<ul>
 <p><li> Much used in the early days of finite elements</li>
 <p><li> Still much used in structural analysis and elasticity</li>
 <p><li> Not as general as Galerkin's method (since \( a(u,v)=a(v,u) \))</li>
</ul>
<p>


</section>


<section>

<h2>Examples on variational formulations <a name="fem:deq:1D:varform:ex"></a></h2>

<p>
<div class="alert alert-block alert-block alert-text-normal"><b>Goal.</b>
Derive variational formulations for many prototype differential
equations in 1D that include

<p>

<ul>
 <p><li> variable coefficints</li>
 <p><li> mixed Dirichlet and Neumann conditions</li>
 <p><li> nonlinear coefficients</li>
</ul>
<p>
</div>
<p>

</section>


<section>

<h3>Variable coefficient; problem  <a name="___sec32"></a></h3>

<p>
<p>&nbsp;<br>
$$
\begin{equation}
-\frac{d}{dx}\left( \dfc(x)\frac{du}{dx}\right) = f(x),\quad x\in\Omega =[0,L],\ 
u(0)=C,\ u(L)=D\tp
\end{equation}
$$
<p>&nbsp;<br>


<p>

<ul>
 <p><li> Variable coefficient \( \dfc(x) \)</li>
 <p><li> <em>Nonzero</em> Dirichlet conditions at \( x=0 \) <em>and</em> \( x=L \)</li>
 <p><li> Must have \( \baspsi_i(0)=\baspsi_i(L)=0 \)</li>
 <p><li> \( V = \hbox{span}\{\baspsi_0,\ldots,\baspsi_N\} \)</li>
 <p><li> \( v\in V \): \( v(0)=v(L)=0 \)</li>
</ul>
<p>

<p>&nbsp;<br>
$$
u(x) = B(x) + \sum_{j\in\If} c_j\baspsi_i(x)
$$
<p>&nbsp;<br>


<p>
<p>&nbsp;<br>
$$ B(x) = C + \frac{1}{L}(D-C)x$$
<p>&nbsp;<br>


<p>

</section>


<section>

<h3>Variable coefficient; variational formulation (1)  <a name="___sec33"></a></h3>

<p>
<p>&nbsp;<br>
$$ R = -\frac{d}{dx}\left( a\frac{du}{dx}\right) -f $$
<p>&nbsp;<br>


<p>
Galerkin's method:

<p>
<p>&nbsp;<br>
$$
(R, v) = 0,\quad \forall v\in V,
$$
<p>&nbsp;<br>


<p>
or with integrals:

<p>
<p>&nbsp;<br>
$$
\int_{\Omega} \left(\frac{d}{dx}\left( \dfc\frac{du}{dx}\right) -f\right)v \dx = 0,\quad \forall v\in V \tp
$$
<p>&nbsp;<br>


<p>

</section>


<section>

<h3>Variable coefficient; variational formulation (2)  <a name="___sec34"></a></h3>

<p>
Integration by parts:

<p>
<p>&nbsp;<br>
$$ -\int_{\Omega} \frac{d}{dx}\left( \dfc(x)\frac{du}{dx}\right) v \dx
= \int_{\Omega} \dfc(x)\frac{du}{dx}\frac{dv}{dx}\dx -
\left[\dfc\frac{du}{dx}v\right]_0^L
\tp
$$
<p>&nbsp;<br>


<p>
Boundary terms vanish since \( v(0)=v(L)=0 \)

<p>
<div class="alert alert-block alert-notice alert-text-normal"><b>Variational formulation.</b>

<p>
Find \( (u-B)\in V \) such that

<p>
<p>&nbsp;<br>
$$
\int_{\Omega} \dfc(x)\frac{du}{dx}\frac{dv}{dx}dx = \int_{\Omega} f(x)vdx,\quad
\forall v\in V,
$$
<p>&nbsp;<br>


<p>
Compact notation:

<p>
<p>&nbsp;<br>
$$ (\dfc u',v') = (f,v),\quad \forall v\in V $$
<p>&nbsp;<br>
</div>
<p>

</section>


<section>

<h3>Variable coefficient; abstract notation  <a name="___sec35"></a></h3>

<p>
<p>&nbsp;<br>
$$ a(u,v)=L(v)\quad\forall v\in V,$$
<p>&nbsp;<br>


<p>
<p>&nbsp;<br>
$$ a(u,v)= (\dfc u',v'),\quad L(v)=(f,v)   $$
<p>&nbsp;<br>


<p>

</section>


<section>

<h3>Variable coefficient; linear system  <a name="___sec36"></a></h3>

<p>
\( v=\baspsi_i \) and \( u=B + \sum_jc_j\baspsi_j \):

<p>
<p>&nbsp;<br>
$$
(\dfc B' + \dfc \sum_{j\in\If} c_j \baspsi_j', \baspsi_i') =
(f,\baspsi_i), \quad i\in\If \tp
$$
<p>&nbsp;<br>


<p>
Reorder to form linear system:

<p>
<p>&nbsp;<br>
$$ \sum_{j\in\If} (\dfc\baspsi_j', \baspsi_i')c_j  =
(f,\baspsi_i) + (a(D-C)L^{-1}, \baspsi_i'), \quad i\in\If
\tp
$$
<p>&nbsp;<br>


<p>
This is \( \sum_j A_{i,j}c_j=b_i \) with

<p>
<p>&nbsp;<br>
$$
\begin{align*}
A_{i,j} &= (a\baspsi_j', \baspsi_i') = \int_{\Omega} \dfc(x)\baspsi_j'(x),
\baspsi_i'(x)\dx,\\ 
b_i &= (f,\baspsi_i) + (a(D-C)L^{-1},\baspsi_i')=
\int_{\Omega} \left(f(x)\baspsi_i(x) + \dfc(x)\frac{D-C}{L}\baspsi_i'(x)\right) \dx
\tp
\end{align*}
$$
<p>&nbsp;<br>


<p>

</section>


<section>

<h3>First-order derivative in the equation and boundary condition; problem  <a name="___sec37"></a></h3>

<p>
<p>&nbsp;<br>
$$
\begin{equation}
-u''(x) + bu'(x) = f(x),\quad x\in\Omega =[0,L],\ 
u(0)=C,\ u'(L)=E
\end{equation}
$$
<p>&nbsp;<br>


<p>
New features:

<p>

<ul>
 <p><li> first-order derivative \( u' \) in the equation</li>
 <p><li> boundary condition with \( u' \): \( u'(L)=E \)</li>
</ul>
<p>

Initial steps:

<p>

<ul>
 <p><li> Must force \( \baspsi_i(0)=0 \) because of Dirichlet condition at \( x=0 \)</li>
 <p><li> Boundary function: \( B(x)=C(L-x)/L \)</li>
 <p><li> No requirements on \( \baspsi_i(L) \) (no Dirichlet condition at \( x=L \))</li>
</ul>
<p>


</section>


<section>

<h3>First-order derivative in the equation and boundary condition; details  <a name="___sec38"></a></h3>

<p>
<p>&nbsp;<br>
$$ u = \frac{C}{L}(L-x) + \sum_{j\in\If} c_j \baspsi_i(x)$$
<p>&nbsp;<br>


<p>
Galerkin's method: multiply by \( v \), integrate over \( \Omega \), integrate
by parts.

<p>
<p>&nbsp;<br>
$$  (-u'' + bu' - f, v) = 0,\quad\forall v\in V,$$
<p>&nbsp;<br>


<p>
<p>&nbsp;<br>
$$ (u',v') + (bu',v) = (f,v) + [u' v]_0^L, \quad\forall v\in V,$$
<p>&nbsp;<br>


<p>
<p>&nbsp;<br>
$$ (u'v') + (bu',v) = (f,v) + Ev(L), \quad\forall v\in V,$$
<p>&nbsp;<br>


<p>

</section>


<section>

<h3>First-order derivative in the equation and boundary condition; observations  <a name="___sec39"></a></h3>

<p>
<p>&nbsp;<br>
$$ (u'v') + (bu',v) = (f,v) + Ev(L), \quad\forall v\in V,$$
<p>&nbsp;<br>


<p>
Important:

<p>

<ul>
  <p><li> \( [u' v]_0^L = u'(L)v(L) = E v(L) \) because \( v(0)=0 \) and \( u'(L)=E \)</li>
  <p><li> The boundary term can be used to implement Neumann conditions</li>
  <p><li> Forgetting the boundary term implies the condition \( u'=0 \) (!)</li>
  <p><li> Such conditions are called <em>natural boundary conditions</em></li>
</ul>
<p>


</section>


<section>

<h3>First-order derivative in the equation and boundary condition; abstract notation  <a name="___sec40"></a></h3>

<p>
Abstract notation:

<p>
<p>&nbsp;<br>
$$ a(u,v)=L(v)\quad\forall v\in V,$$
<p>&nbsp;<br>


<p>
where

<p>
<p>&nbsp;<br>
$$ a(u,v)=(u',v') + (bu',v),\quad L(v)= (f+C,v) + E v(L) $$
<p>&nbsp;<br>


<p>

</section>


<section>

<h3>First-order derivative in the equation and boundary condition; linear system  <a name="___sec41"></a></h3>

<p>
Insert \( u=B+\sum_jc_j\baspsi_j \) and \( v=\baspsi_i \):

<p>
<p>&nbsp;<br>
$$
\sum_{j\in\If}
\underbrace{((\baspsi_j',\baspsi_i') + (b\baspsi_j',\baspsi_i))}_{A_{i,j}}
c_j =
\underbrace{(f,\baspsi_i) + (bCL^{-1},\baspsi_i') + E \baspsi_i(L)}_{b_i}
$$
<p>&nbsp;<br>


<p>
Observation: \( A_{i,j} \) is not symmetric because of the term

<p>
<p>&nbsp;<br>
$$
(b\baspsi_j',\baspsi_i)=\int_{\Omega} b\baspsi_j'\baspsi_i dx
 \neq \int_{\Omega} b \baspsi_i' \baspsi_jdx = (\baspsi_i',b\baspsi_j)
$$
<p>&nbsp;<br>


<p>

</section>


<section>

<h3>Terminology: natural and essential boundary conditions  <a name="___sec42"></a></h3>

<p>
<p>&nbsp;<br>
$$ (u',v') + (bu',v) = (f,v) + u'(L)v(L) - u'(0)v(0)$$
<p>&nbsp;<br>


<p>

<ul>
 <p><li> Note: forgetting the boundary terms implies \( u'(L)=u'(0)=0 \)
   (unless prescribe a Dirichlet condition)</li>
 <p><li> Conditions on \( u' \) are simply inserted in the variational form
   and called <em>natural conditions</em></li>
 <p><li> Conditions on \( u \) at \( x=0 \) requires modifying \( V \) (through \( \baspsi_i(0)=0 \))
   and are known as <em>essential conditions</em></li>
</ul>
<p>

<div class="alert alert-block alert-notice alert-text-normal"><b>Lesson learned.</b>
It is easy to forget the boundary term when integrating by parts.
That mistake may prescribe a condition on \( u' \)!
</div>
<p>

</section>


<section>

<h3>Nonlinear coefficient; problem  <a name="___sec43"></a></h3>

<p>
<p>&nbsp;<br>
$$
\begin{equation}
-(\dfc(u)u')' = f(u),\quad x\in [0,L],\ u(0)=0,\ u'(L)=E
\tp
\end{equation}
$$
<p>&nbsp;<br>


<p>

<ul>
 <p><li> \( V \): basis \( \sequencei{\baspsi} \) with \( \baspsi_i(0)=0 \) because of \( u(0)=0 \)</li>
 <p><li> How does the nonlinear coefficient \( \dfc(u) \) impact the variational
   formulation?</li>
</ul>
<p>


</section>


<section>

<h3>Nonlinear coefficient; variational formulation  <a name="___sec44"></a></h3>

<p>
Galerkin: multiply by \( v \), integrate, integrate by parts

<p>
<p>&nbsp;<br>
$$ \int_0^L \dfc(u)\frac{du}{dx}\frac{dv}{dx}\dx =
\int_0^L f(u)v\dx + [\dfc(u)vu']_0^L\quad\forall v\in V
$$
<p>&nbsp;<br>


<p>

<ul>
 <p><li> \( \dfc(u(0))v(0)u'(0)=0 \) since \( v(0) \)</li>
 <p><li> \( \dfc(u(L))v(L)u'(L) = \dfc(u(L))v(L)E \) since \( u'(L)=E \)</li>
</ul>
<p>

<p>&nbsp;<br>
$$ \int_0^L \dfc(u)\frac{du}{dx}\frac{dv}{dx}v\dx =
\int_0^L f(u)v\dx + \dfc(u(L))v(L)E\quad\forall v\in V
$$
<p>&nbsp;<br>


<p>
or

<p>
<p>&nbsp;<br>
$$ (\dfc(u)u', v') = (f(u),v) + \dfc(L)v(L)E\quad\forall v\in V
$$
<p>&nbsp;<br>


<p>

</section>


<section>

<h3>Nonlinear coefficient; where does the nonlinearity cause challenges?  <a name="___sec45"></a></h3>

<p>

<ul>
 <p><li> Abstract notation: no \( a(u,v) \) and \( L(v) \) because \( a \) and \( L \) are nonlinear</li>
 <p><li> Abstract notation: \( F(u;v)=0 \) $\forall v\in V$</li>
 <p><li> What about forming a linear system? We get a <em>nonlinear</em> system of
   algebraic equations</li>
 <p><li> Must use methods like Picard iteration or Newton's method to solve
   nonlinear algebraic equations</li>
 <p><li> But: the variational formulation was not much affected by nonlinearities</li>
</ul>
<p>


</section>


<section>

<h3>Computing with Dirichlet and Neumann conditions; problem  <a name="___sec46"></a></h3>

<p>
<p>&nbsp;<br>
$$
\begin{equation*}
-u''(x)=f(x),\quad x\in \Omega=[0,1],\quad u'(0)=C,\ u(1)=D
\end{equation*}
$$
<p>&nbsp;<br>


<p>

<ul>
 <p><li> Use a <em>global</em> polynomial basis \( \baspsi_i\sim x^i \) on \( [0,1] \)</li>
 <p><li> Because of \( u(1)=D \): \( \baspsi_i(1)=0 \)</li>
 <p><li> Basis: \( \baspsi_i(x)=(1-x)^{i+1} \), \( i\in\If \)</li>
 <p><li> \( B(x)=Dx \)</li>
</ul>
<p>


</section>


<section>

<h3>Computing with Dirichlet and Neumann conditions; details  <a name="___sec47"></a></h3>

<p>
<p>&nbsp;<br>
$$ A_{i,j} = (\baspsi_j',\baspsi_i') = \int_{0}^1 \baspsi_i'(x)\baspsi_j'(x)dx
= \int_0^1 (i+1)(j+1)(1-x)^{i+j} dx,
$$
<p>&nbsp;<br>


<p>
<p>&nbsp;<br>
$$
\begin{align*}
b_i &= (2,\baspsi_i) - (D,\baspsi_i') -C\baspsi_i(0)\\ 
&= \int_0^1 \left( 2(1-x)^{i+1} - D(i+1)(1-x)^i\right)dx  -C\baspsi_i(0)
\end{align*}
$$
<p>&nbsp;<br>


<p>
Can easily do the integrals with <code>sympy</code>. \( N=1 \):

<p>
<p>&nbsp;<br>
$$
\begin{equation*}
\left(\begin{array}{cc}
1 & 1\\ 
1 & 4/3
\end{array}\right)
\left(\begin{array}{c}
c_0\\ 
c_1
\end{array}\right)
=
\left(\begin{array}{c}
-C+D+1\\ 
2/3 -C + D
\end{array}\right)
\end{equation*}
$$
<p>&nbsp;<br>


<p>
<p>&nbsp;<br>
$$ c_0=-C+D+2, \quad c_1=-1,$$
<p>&nbsp;<br>


<p>
<p>&nbsp;<br>
$$ u(x) = 1 -x^2 + D + C(x-1)\quad\hbox{(exact solution)} $$
<p>&nbsp;<br>


<p>

</section>


<section>

<h3>When the numerical method is exact  <a name="___sec48"></a></h3>

<p>
Let

<p>
$$
\begin{align*}
u &= B + F,\quad F\in V
a(B+F, v) &= L(v)\quad\forall v\in V
\uex & = B + E,\quad E\in V
a(B+E, v) &= L(v)\quad\forall v\in V
\end{align*}

Subtract: $a(F-E,v)=0$ and $E=F$.

Apart from boundary conditions, $\uex$ lies in the same as we seek $u$.
Then $u=\uex$.


!split
========= Computing with finite elements =========
\tag{18}

Tasks:

 * Address the model problem $-u''(x)=2$, $u(0)=u(L)=0$
 * Uniform finite element mesh with P1 elements
 * Show all finite element computations in detail

!split
======= Variational formulation, finite element mesh, and basis =======

<p>&nbsp;<br>
$$ -u''(x) = 2,\quad x\in (0,L),\ u(0)=u(L)=0,$$
<p>&nbsp;<br>


<p>
Variational formulation:

<p>
<p>&nbsp;<br>
$$ (u',v') = (2,v)\quad\forall v\in V  $$
<p>&nbsp;<br>


<p>
Since \( u(0)=0 \) and \( u(L)=0 \), we must force

<p>
<p>&nbsp;<br>
$$ v(0)=v(L)=0,\quad \baspsi_i(0)=\baspsi_i(L)=0$$
<p>&nbsp;<br>


<p>
Use finite element basis, but exclude \( \basphi_0 \) and \( \basphi_{N_n} \)
since these are not 0 on the boundary:

<p>
<p>&nbsp;<br>
$$ \baspsi_i=\basphi_{i+1},\quad i=0,\ldots,N=N_n-2$$
<p>&nbsp;<br>


<p>
<p>&nbsp;<br>
$$ u = \sum_{j\in\If}c_j\basphi_{\nu(i)},\quad i=0,\ldots,N,\quad \nu(j) = j+1$$
<p>&nbsp;<br>


<p>
Irregular numbering: more complicated \( \nu(j) \) mapping

<p>

</section>


<section>

<h3>Computation in the global physical domain; formulas  <a name="___sec49"></a></h3>

<p>
<p>&nbsp;<br>
$$
\begin{equation*}
A_{i,j}=\int_0^L\basphi_{i+1}'(x)\basphi_{j+1}'(x) dx,\quad
b_i=\int_0^L2\basphi_{i+1}(x) dx
\end{equation*}
$$
<p>&nbsp;<br>


<p>
\( i+1\rightarrow i \), \( j+1\rightarrow j \)

<p>
<p>&nbsp;<br>
$$
\begin{equation*}
A_{i-1,j-1}=\int_0^L\basphi_{i}'(x)\basphi_{j}'(x) \dx,\quad
b_{i-1}=\int_0^L2\basphi_{i}(x) \dx
\end{equation*}
$$
<p>&nbsp;<br>


<p>

</section>


<section>

<h3>Computation in the global physical domain; details  <a name="___sec50"></a></h3>

<p>
<center><p><img src="fig-fem/fe_mesh1D_dphi_2_3.png" align="bottom" width=400></p></center>

<p>
<p>&nbsp;<br>
$$ \basphi_i = \pm h^{-1} $$
<p>&nbsp;<br>


<p>
<p>&nbsp;<br>
$$ A_{i-1,i-1} = h^{-2}2h = 2h^{-1},\quad
A_{i-1,i-2} = h^{-1}(-h^{-1})h = -h^{-1},\quad A_{i-1,i}=A_{i-1,i-2}$$
<p>&nbsp;<br>


<p>
<p>&nbsp;<br>
$$ b_{i-1} = 2(\frac{1}{2}h + \frac{1}{2}h) = 2h$$
<p>&nbsp;<br>


<p>

</section>


<section>

<h3>Computation in the global physical domain; linear system  <a name="___sec51"></a></h3>

<p>
<p>&nbsp;<br>
$$
\begin{equation}
\frac{1}{h}\left(
\begin{array}{ccccccccc}
2 & -1 & 0
&\cdots &
\cdots & \cdots & \cdots &
\cdots & 0 \\ 
-1 & 2 & -1 & \ddots &   & &  & &  \vdots \\ 
0 & -1 & 2 & -1 &
\ddots & &  &  & \vdots \\ 
\vdots & \ddots &  & \ddots & \ddots & 0 &  & & \vdots \\ 
\vdots &  & \ddots & \ddots & \ddots & \ddots & \ddots & & \vdots \\ 
\vdots & &  & 0 & -1 & 2 & -1 & \ddots & \vdots \\ 
\vdots & & &  & \ddots & \ddots & \ddots &\ddots  & 0 \\ 
\vdots & & & &  &\ddots  & \ddots &\ddots  & -1 \\ 
0 &\cdots & \cdots &\cdots & \cdots & \cdots  & 0 & -1 & 2
\end{array}
\right)
\left(
\begin{array}{c}
c_0 \\ 
\vdots\\ 
\vdots\\ 
\vdots \\ 
\vdots \\ 
\vdots \\ 
\vdots \\ 
\vdots\\ 
c_{N}
\end{array}
\right)
=
\left(
\begin{array}{c}
2h \\ 
\vdots\\ 
\vdots\\ 
\vdots \\ 
\vdots \\ 
\vdots \\ 
\vdots \\ 
\vdots\\ 
2h
\end{array}
\right)
\tag{19}
\end{equation}
$$
<p>&nbsp;<br>


<p>

</section>


<section>

<h3>Comparison with a finite difference discretization  <a name="___sec52"></a></h3>

<p>

<ul>
 <p><li> Recall: \( c_i = u(\xno{i+1})\equiv u_{i+1} \)</li>
 <p><li> Write out a general equation at node \( i-1 \), expressed by \( u_i \)</li>
</ul>
<p>

<p>&nbsp;<br>
$$
\begin{equation}
-\frac{1}{h}u_{i-1} + \frac{2}{h}u_{i} - \frac{1}{h}u_{i+1} = 2h
\tag{20}
\end{equation}
$$
<p>&nbsp;<br>


<p>
The standard finite difference method for \( -u''=2 \) is

<p>
<p>&nbsp;<br>
$$ -\frac{1}{h^2}u_{i-1} + \frac{2}{h^2}u_{i} - \frac{1}{h^2}u_{i+1} = 2 $$
<p>&nbsp;<br>


<p>
<div class="alert alert-block alert-block alert-text-normal"><b></b>
The finite element method and the finite difference method are
identical <em>in this example</em>.
</div>
<p>
(Remains to study the equations involving boundary values)

<p>

</section>


<section>

<h3>Cellwise computations; formulas <a name="fem:deq:1D:comp:elmwise"></a></h3>

<p>

<ul>
 <p><li> Repeat the previous example, but apply the cellwise algorithm</li>
 <p><li> Work with one cell at a time</li>
 <p><li> Thansform physical cell to reference cell \( X\in [-1,1] \)</li>
</ul>
<p>

<p>&nbsp;<br>
$$
\begin{equation*}
A_{i-1,j-1}^{(e)}=\int_{\Omega^{(e)}} \basphi_i'(x)\basphi_j'(x) \dx
= \int_{-1}^1 \frac{d}{dx}\refphi_r(X)\frac{d}{dx}\refphi_s(X)
\frac{h}{2} \dX,
\end{equation*}
$$
<p>&nbsp;<br>


<p>
<p>&nbsp;<br>
$$ \refphi_0(X)=\half(1-X),\quad\refphi_1(X)=\half(1+X)$$
<p>&nbsp;<br>


<p>
<p>&nbsp;<br>
$$ \frac{d\refphi_0}{dX} = -\half,\quad  \frac{d\refphi_1}{dX} = \half $$
<p>&nbsp;<br>


<p>
From the chain rule

<p>
<p>&nbsp;<br>
$$ \frac{d\refphi_r}{dx} = \frac{d\refphi_r}{dX}\frac{dX}{dx}
= \frac{2}{h}\frac{d\refphi_r}{dX}$$
<p>&nbsp;<br>


<p>

</section>


<section>

<h3>Cellwise computations; details  <a name="___sec54"></a></h3>

<p>
<p>&nbsp;<br>
$$
\begin{equation*}
A_{i-1,j-1}^{(e)}=\int_{\Omega^{(e)}} \basphi_i'(x)\basphi_j'(x) \dx
= \int_{-1}^1 \frac{2}{h}\frac{d\refphi_r}{dX}\frac{2}{h}\frac{d\refphi_s}{dX}
\frac{h}{2} \dX
\end{equation*}
$$
<p>&nbsp;<br>


<p>
<p>&nbsp;<br>
$$
\begin{equation*}
b_{i-1}^{(e)} = \int_{\Omega^{(e)}} 2\basphi_i(x) \dx =
\int_{-1}^12\refphi_r(X)\frac{h}{2} \dX,\quad i=q(e,r),\ r=0,1
\end{equation*}
$$
<p>&nbsp;<br>


<p>
Must run through all \( r,s=0,1 \) and \( r=0,1 \) and compute each entry in
the element matrix and vector:

<p>
<p>&nbsp;<br>
$$
\begin{equation}
\tilde A^{(e)} =\frac{1}{h}\left(\begin{array}{rr}
1 & -1\\ 
-1 & 1
\end{array}\right),\quad
\tilde b^{(e)} = h\left(\begin{array}{c}
1\\ 
1
\end{array}\right)\tp
\tag{21}
\end{equation}
$$
<p>&nbsp;<br>


<p>

</section>


<section>

<h3>Cellwise computations; details of boundary cells  <a name="___sec55"></a></h3>

<p>

<ul>
 <p><li> The boundary cells involve only one unknown</li>
 <p><li> \( \Omega^{(0)} \): left node value known,
   only a contribution from right node</li>
 <p><li> \( \Omega^{(N_e)} \): right node value known,
   only a contribution from left node</li>
</ul>
<p>

<p>&nbsp;<br>
$$
\tilde A^{(e)} =\frac{1}{h}\left(\begin{array}{r}
1
\end{array}\right),\quad
\tilde b^{(e)} = h\left(\begin{array}{c}
1
\end{array}\right),\quad e=0,\ e=N_e
$$
<p>&nbsp;<br>


<p>
Only one degree of freedom ("node") in these cells (\( r=0 \))

<p>

</section>


<section>

<h3>Cellwise computations; assembly  <a name="___sec56"></a></h3>

<p>
4 P1 elements:

<p>

<!-- code=python (from !bc pycod) typeset with pygments style "native" -->
<div class="highlight" style="background: #202020"><pre style="line-height: 125%"><span style="color: #d0d0d0">vertices</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">[</span><span style="color: #3677a9">0</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">0.5</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">1</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">1.5</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">2</span><span style="color: #d0d0d0">]</span>
<span style="color: #d0d0d0">cells</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">[[</span><span style="color: #3677a9">0</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">1</span><span style="color: #d0d0d0">],</span> <span style="color: #d0d0d0">[</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">2</span><span style="color: #d0d0d0">],</span> <span style="color: #d0d0d0">[</span><span style="color: #3677a9">2</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">3</span><span style="color: #d0d0d0">],</span> <span style="color: #d0d0d0">[</span><span style="color: #3677a9">3</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">4</span><span style="color: #d0d0d0">]]</span>
<span style="color: #d0d0d0">dof_map</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">[[</span><span style="color: #3677a9">0</span><span style="color: #d0d0d0">],</span> <span style="color: #d0d0d0">[</span><span style="color: #3677a9">0</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">1</span><span style="color: #d0d0d0">],</span> <span style="color: #d0d0d0">[</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">2</span><span style="color: #d0d0d0">],</span> <span style="color: #d0d0d0">[</span><span style="color: #3677a9">2</span><span style="color: #d0d0d0">]]</span>
</pre></div>
<p>
Python code for the assembly algorithm:

<p>

<!-- code=python (from !bc pycod) typeset with pygments style "native" -->
<div class="highlight" style="background: #202020"><pre style="line-height: 125%"><span style="color: #999999; font-style: italic"># Ae[e][r,s]: element matrix, be[e][r]: element vector</span>
<span style="color: #999999; font-style: italic"># A[i,j]: coefficient matrix, b[i]: right-hand side</span>

<span style="color: #6ab825; font-weight: bold">for</span> <span style="color: #d0d0d0">e</span> <span style="color: #6ab825; font-weight: bold">in</span> <span style="color: #24909d">range</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">len</span><span style="color: #d0d0d0">(Ae)):</span>
    <span style="color: #6ab825; font-weight: bold">for</span> <span style="color: #d0d0d0">r</span> <span style="color: #6ab825; font-weight: bold">in</span> <span style="color: #24909d">range</span><span style="color: #d0d0d0">(Ae[e].shape[</span><span style="color: #3677a9">0</span><span style="color: #d0d0d0">]):</span>
        <span style="color: #6ab825; font-weight: bold">for</span> <span style="color: #d0d0d0">s</span> <span style="color: #6ab825; font-weight: bold">in</span> <span style="color: #24909d">range</span><span style="color: #d0d0d0">(Ae[e].shape[</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">]):</span>
            <span style="color: #d0d0d0">A[dof_map[e,r],dof_map[e,s]]</span> <span style="color: #d0d0d0">+=</span> <span style="color: #d0d0d0">Ae[e][i,j]</span>
        <span style="color: #d0d0d0">b[dof_map[e,r]]</span> <span style="color: #d0d0d0">+=</span> <span style="color: #d0d0d0">be[e][i,j]</span>
</pre></div>
<p>
Result: same linear system

<h2>Boundary conditions: specified nonzero value <a name="fem:deq:1D:essBC"></a></h2>

<h3>General construction of a boundary function <a name="fem:deq:1D:essBC:Bfunc"></a></h3>

<p>

<ul>
  <p><li> \( B(x) \) is not always easy to construct (extend to the interior of \( \Omega \)),
    at least not in 2D and 3D</li>
  <p><li> With finite element \( \basphi_i \), \( B(x) \) can be constructed in
    a completely general way</li>
  <p><li> \( \Ifb \): set of indices with nodes where \( u \) is known</li>
  <p><li> \( U_i \): Dirichlet value of \( u \) at node \( i \), \( i\in\Ifb \)</li>
</ul>
<p>

<p>&nbsp;<br>
$$
\begin{equation}
B(x) = \sum_{j\in\Ifb} U_j\basphi_j(x),
\end{equation}
$$
<p>&nbsp;<br>


<p>
1D: \( \Ifb = \{1,N_n\} \)

<p>
<p>&nbsp;<br>
$$
\begin{equation}
u(x) = U_0\basphi_0(x) + U_{N_n}\basphi_{N_n}(x)
+ \sum{j\in\If}c_j\basphi_{\nu(j)},\quad \nu(j)=j+1,\ N=N_n-2
\end{equation}
$$
<p>&nbsp;<br>


<p>

</section>


<section>

<h3>Example with two Dirichlet values; variational formulation  <a name="___sec59"></a></h3>

<p>
<p>&nbsp;<br>
$$ -u''=2, \quad u(0)=C,\ u(L)=D  $$
<p>&nbsp;<br>


<p>
<p>&nbsp;<br>
$$ (u',v') = (2,v)\quad\forall v\in V$$
<p>&nbsp;<br>


<p>
Insert \( u = B + \sum_j c_j\baspsi_j \) in variational formulation:

<p>
<p>&nbsp;<br>
$$
A_{i,j} = \int_0^L \baspsi_i'(x)\baspsi_j'(x) \dx,\quad
b_i = \int_0^L (f(x) - B'(x))\baspsi_i(x) \dx
$$
<p>&nbsp;<br>


<p>

</section>


<section>

<h3>Example with two Dirichlet values; details  <a name="___sec60"></a></h3>

<p>
\( \baspsi_i = \basphi_{i+1} \), \( i=0,\ldots,N=N_n-2 \)

<p>
<p>&nbsp;<br>
$$
\begin{align*}
u(x) &= \underline{0\cdot\basphi_0 + D\basphi_{N_n}}_{B(x)}
+ \sum_{j\in\If} c_j\basphi_{j+1}
&= D\basphi_{N_n} + c_0\basphi_1 + c_1\basphi_2 +\cdots
+ c_N\basphi_{N_n-1}\tp
\end{align*}
$$
<p>&nbsp;<br>


<p>
<p>&nbsp;<br>
$$
A_{i-1,j-1} = \int_0^L \basphi_i'(x)\basphi_j'(x) \dx,\quad
b_{i-1} = \int_0^L (f(x) - D\basphi_{N_n}'(x))\basphi_i(x) \dx,
$$
<p>&nbsp;<br>

for \( i,j = 1,\ldots,N+1=N_n-1 \).

<p>
New boundary term from \( B' \): \( -D/2 \)

<p>

</section>


<section>

<h3>Example with two Dirichlet values; cellwise computations  <a name="___sec61"></a></h3>

<p>

<ul>
 <p><li> Element matrices as in the previous example (with \( u=0 \) on the boundary)</li>
 <p><li> New element vector</li>
</ul>
<p>

<p>&nbsp;<br>
$$
\tilde b_0^{(e)} = \int_{-1}^1 \left(f - D\frac{2}{h}\frac{\refphi_1}{dX}\right)
\refphi_0\frac{h}{2} \dX
= (\frac{h}{2}(2 - D\frac{2}{h}\frac{1}{2})
\int_{-1}^1 \refphi_0 \dX =  h - D/2,\quad e=N_e=N_n-1
$$
<p>&nbsp;<br>


<p>

</section>


<section>

<h3>Modification of the linear system; ideas <a name="fem:deq:1D:fem:essBC:Bfunc:modsys"></a></h3>

<p>

<ul>
 <p><li> Method 1: incorporate Dirichlet values through a \( B(x) \) function
   and demand \( \baspsi_i=0 \) where Dirichlet values apply</li>
 <p><li> Method 2: drop \( B(x) \), drop demands to \( \baspsi_i \), just assemble
   as if there were no Dirichlet conditions, and modify the linear
   system instead</li>
</ul>
<p>

Method 2: \( \baspsi_i = \basphi_i \)

<p>
<p>&nbsp;<br>
$$
\begin{equation}
u(x) = \sum_{j\in\If}c_j\basphi_j(x),\quad \If=\{0,\ldots,N=N_n\}
\tag{22}
\end{equation}
$$
<p>&nbsp;<br>


<p>
\( u \) is treated as unknown at \( x=0 \) and \( x=L \)

<p>

</section>


<section>

<h3>Modification of the linear system; linear system  <a name="___sec63"></a></h3>

<p>
<p>&nbsp;<br>
$$ -u''=2,\quad u(0)=0,\ u(L)=D$$
<p>&nbsp;<br>


<p>
<p>&nbsp;<br>
$$
\begin{equation}
\frac{1}{h}\left(
\begin{array}{ccccccccc}
1 & -1 & 0
&\cdots &
\cdots & \cdots & \cdots &
\cdots & 0 \\ 
-1 & 2 & -1 & \ddots &   & &  & &  \vdots \\ 
0 & -1 & 2 & -1 &
\ddots & &  &  & \vdots \\ 
\vdots & \ddots &  & \ddots & \ddots & 0 &  & & \vdots \\ 
\vdots &  & \ddots & \ddots & \ddots & \ddots & \ddots & & \vdots \\ 
\vdots & &  & 0 & -1 & 2 & -1 & \ddots & \vdots \\ 
\vdots & & &  & \ddots & \ddots & \ddots &\ddots  & 0 \\ 
\vdots & & & &  &\ddots  & \ddots &\ddots  & -1 \\ 
0 &\cdots & \cdots &\cdots & \cdots & \cdots  & 0 & -1 & 1
\end{array}
\right)
\left(
\begin{array}{c}
c_0 \\ 
\vdots\\ 
\vdots\\ 
\vdots \\ 
\vdots \\ 
\vdots \\ 
\vdots \\ 
\vdots\\ 
c_{N}
\end{array}
\right)
=
\left(
\begin{array}{c}
h \\ 
2h\\ 
\vdots\\ 
\vdots \\ 
\vdots \\ 
\vdots \\ 
\vdots \\ 
2h\\ 
h
\end{array}
\right)
\tag{23}
\end{equation}
$$
<p>&nbsp;<br>


<p>

</section>


<section>

<h3>Modification of the linear system; modifications  <a name="___sec64"></a></h3>

<p>

<ul>
 <p><li> Dirichlet condition \( u(\xno{i})= U_i \) means \( c_i=U_i \) (since \( c_i=u(\xno{i}) \))</li>
 <p><li> Replace first row by \( c_0=0 \)</li>
 <p><li> Replace last row by \( c_N=D \)</li>
</ul>
<p>

<p>&nbsp;<br>
$$
\begin{equation}
\frac{1}{h}\left(
\begin{array}{ccccccccc}
1 & 0 & 0
&\cdots &
\cdots & \cdots & \cdots &
\cdots & 0 \\ 
-1 & 2 & -1 & \ddots &   & &  & &  \vdots \\ 
0 & -1 & 2 & -1 &
\ddots & &  &  & \vdots \\ 
\vdots & \ddots &  & \ddots & \ddots & 0 &  & & \vdots \\ 
\vdots &  & \ddots & \ddots & \ddots & \ddots & \ddots & & \vdots \\ 
\vdots & &  & 0 & -1 & 2 & -1 & \ddots & \vdots \\ 
\vdots & & &  & \ddots & \ddots & \ddots &\ddots  & 0 \\ 
\vdots & & & &  &\ddots  & \ddots &\ddots  & -1 \\ 
0 &\cdots & \cdots &\cdots & \cdots & \cdots  & 0 & 0 & 1
\end{array}
\right)
\left(
\begin{array}{c}
c_0 \\ 
\vdots\\ 
\vdots\\ 
\vdots \\ 
\vdots \\ 
\vdots \\ 
\vdots \\ 
\vdots\\ 
c_{N}
\end{array}
\right)
=
\left(
\begin{array}{c}
0 \\ 
2h\\ 
\vdots\\ 
\vdots \\ 
\vdots \\ 
\vdots \\ 
\vdots \\ 
2h\\ 
D
\end{array}
\right)
\tag{24}
\end{equation}
$$
<p>&nbsp;<br>


<p>

</section>


<section>

<h3>Modification of the linear system; element matrix/vector  <a name="___sec65"></a></h3>

<p>
In cell 0 we know \( u \) for local node (degree of freedom) \( r=0 \) and
replace the first cell equation by \( \tilde c_0 = 0 \):

<p>
<p>&nbsp;<br>
$$
\begin{equation}
\tilde A^{(0)} =
A = \frac{1}{h}\left(\begin{array}{rr}
1 & 0\\ 
-1 & 1
\end{array}\right),\quad
\tilde b^{(0)} = \left(\begin{array}{c}
0\\ 
h
\end{array}\right)
\tag{25}
\end{equation}
$$
<p>&nbsp;<br>


<p>
In cell \( N_e \) we know \( u \) for local node \( r=1 \) and replace the last
equation in the cell system by \( \tilde c_1=D \):

<p>
<p>&nbsp;<br>
$$
\begin{equation}
\tilde A^{(N_e)} =
A = \frac{1}{h}\left(\begin{array}{rr}
1 & -1\\ 
0 & 1
\end{array}\right),\quad
\tilde b^{(N_e)} = \left(\begin{array}{c}
h\\ 
D
\end{array}\right)
\tag{26}
\end{equation}
$$
<p>&nbsp;<br>


<p>

</section>


<section>

<h3>Symmetric modification of the linear system; algorithm  <a name="___sec66"></a></h3>

<p>

<ul>
 <p><li> The modification above destroys symmetry of the matrix:
   \( A_{0,1}\neq A_{1,0} \))</li>
 <p><li> Symmetry is often important in 2D and 3D (faster computations)</li>
 <p><li> A more complex modification preserves symmetry</li>
</ul>
<p>

Algorithm for incorporating \( c_i=U_i \):

<p>

<ol>
<p><li> Subtract column \( i \) times \( U_i \) from the right-hand side</li>
<p><li> Zero out column and row no \( i \)</li>
<p><li> Place 1 on the diagonal</li>
<p><li> Set \( b_i=U_i \)</li>
</ol>
<p>


</section>


<section>

<h3>Symmetric modification of the linear system; example  <a name="___sec67"></a></h3>

<p>
<p>&nbsp;<br>
$$
\begin{equation}
\frac{1}{h}\left(
\begin{array}{ccccccccc}
1 & 0 & 0
&\cdots &
\cdots & \cdots & \cdots &
\cdots & 0 \\ 
0 & 2 & -1 & \ddots &   & &  & &  \vdots \\ 
0 & -1 & 2 & -1 &
\ddots & &  &  & \vdots \\ 
\vdots & \ddots &  & \ddots & \ddots & 0 &  & & \vdots \\ 
\vdots &  & \ddots & \ddots & \ddots & \ddots & \ddots & & \vdots \\ 
\vdots & &  & 0 & -1 & 2 & -1 & \ddots & \vdots \\ 
\vdots & & &  & \ddots & \ddots & \ddots &\ddots  & 0 \\ 
\vdots & & & &  &\ddots  & \ddots &\ddots  & 0 \\ 
0 &\cdots & \cdots &\cdots & \cdots & \cdots  & 0 & 0 & 1
\end{array}
\right)
\left(
\begin{array}{c}
c_0 \\ 
\vdots\\ 
\vdots\\ 
\vdots \\ 
\vdots \\ 
\vdots \\ 
\vdots \\ 
\vdots\\ 
c_{N}
\end{array}
\right)
=
\left(
\begin{array}{c}
0 \\ 
2h\\ 
\vdots\\ 
\vdots \\ 
\vdots \\ 
\vdots \\ 
\vdots \\ 
2h +D/h\\ 
D
\end{array}
\right)
\tag{27}
\end{equation}
$$
<p>&nbsp;<br>

<h3>Modification of the element matrix and vector  <a name="___sec68"></a></h3>

<p>

<ul>
 <p><li> Modification of the linear system can be done in the
   the element matrix and vector instead</li>
 <p><li> Exactly the same procedure</li>
</ul>
<p>

Last degree of freedom in the last element is prescribed:

<p>
<p>&nbsp;<br>
$$
\begin{equation}
\tilde A^{(N-1)} =
A = \frac{1}{h}\left(\begin{array}{rr}
1 & -1\\ 
0 & 1
\end{array}\right),\quad
\tilde b^{(N-1)} = \left(\begin{array}{c}
h\\ 
D
\end{array}\right)
\tag{26}
\end{equation}
$$
<p>&nbsp;<br>


<p>
Or symmetric modification:

<p>
<p>&nbsp;<br>
$$
\begin{equation}
\tilde A^{(N-1)} =
A = \frac{1}{h}\left(\begin{array}{rr}
1 & 0\\ 
0 & 1
\end{array}\right),\quad
\tilde b^{(N-1)} = \left(\begin{array}{c}
h + D/h\\ 
D
\end{array}\right)
\tag{29}
\end{equation}
$$
<p>&nbsp;<br>


<p>

</section>


<section>

<h2>Boundary conditions: specified derivative <a name="fem:deq:1D:BC:nat"></a></h2>

<p>
Focus: how to incorporate \( u'(0)=C \) with finite elements.

<p>

</section>


<section>

<h3>The variational formulation  <a name="___sec70"></a></h3>

<p>
Galerkin's method:

<p>
<p>&nbsp;<br>
$$
\begin{equation*}
\int_0^L(u''(x)+f(x))\baspsi_i(x) dx = 0,\quad i\in\If
\end{equation*}
$$
<p>&nbsp;<br>


<p>
Integration of \( u''\basphi_i \) by parts:

<p>
<p>&nbsp;<br>
$$
\begin{equation*}
\int_0^Lu'(x)'\baspsi_i'(x) \dx -(u'(L)\baspsi_i(L) - u'(0)\baspsi_i(0)) =
\int_0^L f(x)\baspsi_i(x) \dx, \quad i\in\If\tp
\end{equation*}
$$
<p>&nbsp;<br>


<p>

<ul>
 <p><li> Since \( \baspsi_i(L)=0 \), \( u'(L)\basphi_i(L)=0 \)</li>
 <p><li> \( u'(0)\basphi_i(0) = C\basphi_i(0) \) since \( u'(0)=C \)</li>
 <p><li> \( \baspsi_i = \basphi_i \), \( i=0,\ldots,N=N_n-1 \)</li>
</ul>
<p>

<p>&nbsp;<br>
$$
\begin{equation*}
\int_0^Lu'(x)\basphi_i'(x) dx + C\basphi_i(0) =
\int_0^L f(x)\basphi_i(x) dx,\quad i\in\If
\end{equation*}
$$
<p>&nbsp;<br>


<p>

</section>


<section>

<h3>What if we use all \( \basphi_i \) and insert the Dirichlet condition in the linear system?  <a name="___sec71"></a></h3>

<p>

<ul>
 <p><li> Now \( \baspsi_i=\basphi_i \), \( i=0,\ldots,N=N_n \)</li>
 <p><li> \( \basphi_N(L)\neq 0 \), so \( u'(L)\basphi_N(L)\neq 0 \)</li>
 <p><li> However, the term \( u'(L)\basphi_N(L) \) in \( b_N \) will be erased when
   we insert the Dirichlet value in \( b_N=D \)</li>
</ul>
<p>

We can forget about the term \( u'(L)\basphi_i(L) \)!

<p>

</section>


<section>

<h3>Linear system  <a name="___sec72"></a></h3>

<p>
<p>&nbsp;<br>
$$
\begin{equation*} u(x) = B(x) + \sum_{j=0}^{N} c_j\basphi_j(x),
\quad B(x) = D\basphi_{N_n}(x),
\end{equation*}
$$
<p>&nbsp;<br>


<p>
<p>&nbsp;<br>
$$
\begin{equation}
\sum_{j=0}^{N-1}\left(
\int_0^L \basphi_i'(x)\basphi_j'(x) dx \right)c_j =
\int_0^L\left(f(x)\basphi_i(x) -D\basphi_N'(x)\basphi_i(x)\right) dx
 - C\basphi_i(0),
\tag{30}
\end{equation}
$$
<p>&nbsp;<br>

for \( i=0,\ldots,N=N_n-1 \).

<p>
Alternatively, we may just work with

<p>
<p>&nbsp;<br>
$$
\begin{equation*}
u(x) = \sum_{j=0}^{N=N_n} c_j\basphi_j(x)
\end{equation*}
$$
<p>&nbsp;<br>


<p>
and modify the last equation to \( c_N=D \) in the linear system.

<p>

</section>


<section>

<h3>How the Neumann condition impacts the lement matrix and vector  <a name="___sec73"></a></h3>

<p>
The extra term with \( C \) affects only the element vector from the
first element:

<p>
<p>&nbsp;<br>
$$
\begin{equation}
\tilde A^{(0)} =
A = \frac{1}{h}\left(\begin{array}{rr}
1 & 1\\ 
-1 & 1
\end{array}\right),\quad
\tilde b^{(0)} = \left(\begin{array}{c}
h - C\\ 
h
\end{array}\right)
\tag{31}
\end{equation}
$$
<p>&nbsp;<br>


<p>

</section>


<section>

<h2>The finite element algorithm  <a name="___sec74"></a></h2>

<p>
The differential equation problem defines the integrals in the variational
formulation.

<p>
Request these functions from the user:

<p>

<!-- code=python (from !bc pycod) typeset with pygments style "native" -->
<div class="highlight" style="background: #202020"><pre style="line-height: 125%"><span style="color: #d0d0d0">integrand_lhs(phi,</span> <span style="color: #d0d0d0">r,</span> <span style="color: #d0d0d0">s,</span> <span style="color: #d0d0d0">x)</span>
<span style="color: #d0d0d0">boundary_lhs(phi,</span> <span style="color: #d0d0d0">r,</span> <span style="color: #d0d0d0">s,</span> <span style="color: #d0d0d0">x)</span>
<span style="color: #d0d0d0">integrand_rhs(phi,</span> <span style="color: #d0d0d0">r,</span> <span style="color: #d0d0d0">x)</span>
<span style="color: #d0d0d0">boundary_rhs(phi,</span> <span style="color: #d0d0d0">r,</span> <span style="color: #d0d0d0">x)</span>
</pre></div>
<p>
Must also have a mesh with <code>vertices</code>, <code>cells</code>, and <code>dof_map</code>

<p>

</section>


<section>

<h3>Python pseudo code; the element matrix and vector  <a name="___sec75"></a></h3>

<p>

<!-- code=python (from !bc pycod) typeset with pygments style "native" -->
<div class="highlight" style="background: #202020"><pre style="line-height: 125%"><span style="color: #d0d0d0">&lt;Declare</span> <span style="color: #6ab825; font-weight: bold">global</span> <span style="color: #d0d0d0">matrix</span> <span style="color: #6ab825; font-weight: bold">and</span> <span style="color: #d0d0d0">rhs:</span> <span style="color: #d0d0d0">A,</span> <span style="color: #d0d0d0">b&gt;</span>

<span style="color: #6ab825; font-weight: bold">for</span> <span style="color: #d0d0d0">e</span> <span style="color: #6ab825; font-weight: bold">in</span> <span style="color: #24909d">range</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">len</span><span style="color: #d0d0d0">(cells)):</span>

    <span style="color: #999999; font-style: italic"># Compute element matrix and vector</span>
    <span style="color: #d0d0d0">n</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">len</span><span style="color: #d0d0d0">(dof_map[e])</span>  <span style="color: #999999; font-style: italic"># no of dofs in this element</span>
    <span style="color: #d0d0d0">h</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">vertices[cells[e][</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">]]</span> <span style="color: #d0d0d0">-</span> <span style="color: #d0d0d0">vertices[cells[e][</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">]]</span>
    <span style="color: #d0d0d0">&lt;Declare</span> <span style="color: #d0d0d0">element</span> <span style="color: #d0d0d0">matrix</span> <span style="color: #6ab825; font-weight: bold">and</span> <span style="color: #d0d0d0">vector:</span> <span style="color: #d0d0d0">A_e,</span> <span style="color: #d0d0d0">b_e&gt;</span>

    <span style="color: #999999; font-style: italic"># Integrate over the reference cell</span>
    <span style="color: #d0d0d0">points,</span> <span style="color: #d0d0d0">weights</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">&lt;numerical</span> <span style="color: #d0d0d0">integration</span> <span style="color: #d0d0d0">rule&gt;</span>
    <span style="color: #6ab825; font-weight: bold">for</span> <span style="color: #d0d0d0">X,</span> <span style="color: #d0d0d0">w</span> <span style="color: #6ab825; font-weight: bold">in</span> <span style="color: #24909d">zip</span><span style="color: #d0d0d0">(points,</span> <span style="color: #d0d0d0">weights):</span>
        <span style="color: #d0d0d0">phi</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">&lt;basis</span> <span style="color: #d0d0d0">functions</span> <span style="color: #6ab825; font-weight: bold">and</span> <span style="color: #d0d0d0">derivatives</span> <span style="color: #d0d0d0">at</span> <span style="color: #d0d0d0">X&gt;</span>
        <span style="color: #d0d0d0">detJ</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">h/</span><span style="color: #3677a9">2</span>
        <span style="color: #d0d0d0">x</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">&lt;affine</span> <span style="color: #d0d0d0">mapping</span> <span style="color: #6ab825; font-weight: bold">from</span> <span style="color: #447fcf; text-decoration: underline">X</span><span style="color: #d0d0d0">&gt;</span>
        <span style="color: #6ab825; font-weight: bold">for</span> <span style="color: #d0d0d0">r</span> <span style="color: #6ab825; font-weight: bold">in</span> <span style="color: #24909d">range</span><span style="color: #d0d0d0">(n):</span>
            <span style="color: #6ab825; font-weight: bold">for</span> <span style="color: #d0d0d0">s</span> <span style="color: #6ab825; font-weight: bold">in</span> <span style="color: #24909d">range</span><span style="color: #d0d0d0">(n):</span>
                <span style="color: #d0d0d0">A_e[r,s]</span> <span style="color: #d0d0d0">+=</span> <span style="color: #d0d0d0">integrand_lhs(phi,</span> <span style="color: #d0d0d0">r,</span> <span style="color: #d0d0d0">s,</span> <span style="color: #d0d0d0">x)*detJ*w</span>
            <span style="color: #d0d0d0">b_e[r]</span> <span style="color: #d0d0d0">+=</span> <span style="color: #d0d0d0">integrand_rhs(phi,</span> <span style="color: #d0d0d0">r,</span> <span style="color: #d0d0d0">x)*detJ*w</span>

    <span style="color: #999999; font-style: italic"># Add boundary terms</span>
    <span style="color: #6ab825; font-weight: bold">for</span> <span style="color: #d0d0d0">r</span> <span style="color: #6ab825; font-weight: bold">in</span> <span style="color: #24909d">range</span><span style="color: #d0d0d0">(n):</span>
        <span style="color: #6ab825; font-weight: bold">for</span> <span style="color: #d0d0d0">s</span> <span style="color: #6ab825; font-weight: bold">in</span> <span style="color: #24909d">range</span><span style="color: #d0d0d0">(n):</span>
            <span style="color: #d0d0d0">A_e[r,s]</span> <span style="color: #d0d0d0">+=</span> <span style="color: #d0d0d0">boundary_lhs(phi,</span> <span style="color: #d0d0d0">r,</span> <span style="color: #d0d0d0">s,</span> <span style="color: #d0d0d0">x)*detJ*w</span>
        <span style="color: #d0d0d0">b_e[r]</span> <span style="color: #d0d0d0">+=</span> <span style="color: #d0d0d0">boundary_rhs(phi,</span> <span style="color: #d0d0d0">r,</span> <span style="color: #d0d0d0">x)*detJ*w</span>
</pre></div>
<p>

</section>


<section>

<h3>Python pseudo code; boundary conditions and assembly  <a name="___sec76"></a></h3>

<p>

<!-- code=python (from !bc pycod) typeset with pygments style "native" -->
<div class="highlight" style="background: #202020"><pre style="line-height: 125%"><span style="color: #6ab825; font-weight: bold">for</span> <span style="color: #d0d0d0">e</span> <span style="color: #6ab825; font-weight: bold">in</span> <span style="color: #24909d">range</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">len</span><span style="color: #d0d0d0">(cells)):</span>
    <span style="color: #d0d0d0">...</span>

    <span style="color: #999999; font-style: italic"># Incorporate essential boundary conditions</span>
    <span style="color: #6ab825; font-weight: bold">for</span> <span style="color: #d0d0d0">r</span> <span style="color: #6ab825; font-weight: bold">in</span> <span style="color: #24909d">range</span><span style="color: #d0d0d0">(n):</span>
        <span style="color: #d0d0d0">global_dof</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">dof_map[e][r]</span>
        <span style="color: #6ab825; font-weight: bold">if</span> <span style="color: #d0d0d0">global_dof</span> <span style="color: #6ab825; font-weight: bold">in</span> <span style="color: #d0d0d0">essbc_dofs:</span>
            <span style="color: #999999; font-style: italic"># dof r is subject to an essential condition</span>
            <span style="color: #d0d0d0">value</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">essbc_docs[global_dof]</span>
            <span style="color: #999999; font-style: italic"># Symmetric modification</span>
            <span style="color: #d0d0d0">b_e</span> <span style="color: #d0d0d0">-=</span> <span style="color: #d0d0d0">value*A_e[:,r]</span>
            <span style="color: #d0d0d0">A_e[r,:]</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">0</span>
            <span style="color: #d0d0d0">A_e[:,r]</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">0</span>
            <span style="color: #d0d0d0">A_e[r,r]</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">1</span>
            <span style="color: #d0d0d0">b_e[r]</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">value</span>

    <span style="color: #999999; font-style: italic"># Assemble</span>
    <span style="color: #6ab825; font-weight: bold">for</span> <span style="color: #d0d0d0">r</span> <span style="color: #6ab825; font-weight: bold">in</span> <span style="color: #24909d">range</span><span style="color: #d0d0d0">(n):</span>
        <span style="color: #6ab825; font-weight: bold">for</span> <span style="color: #d0d0d0">s</span> <span style="color: #6ab825; font-weight: bold">in</span> <span style="color: #24909d">range</span><span style="color: #d0d0d0">(n):</span>
            <span style="color: #d0d0d0">A[dof_map[e][r],</span> <span style="color: #d0d0d0">dof_map[e][r]]</span> <span style="color: #d0d0d0">+=</span> <span style="color: #d0d0d0">A_e[r,s]</span>
        <span style="color: #d0d0d0">b[dof_map[e][r]</span> <span style="color: #d0d0d0">+=</span> <span style="color: #d0d0d0">b_e[r]</span>

<span style="color: #d0d0d0">&lt;solve</span> <span style="color: #d0d0d0">linear</span> <span style="color: #d0d0d0">system&gt;</span>
</pre></div>
<p>

</section>


<section>

<h2>Variational formulations in 2D and 3D <a name="fem:deq:2D:varform"></a></h2>

<p>
<div class="alert alert-block alert-block alert-text-normal"><b></b>
How to do integration by parts is the major difference when moving to
2D and 3D.
</div>
<p>

</section>


<section>

<h3>Integration by parts  <a name="___sec78"></a></h3>

<p>
<p>&nbsp;<br>
$$
\nabla\cdot\left( a(\x)\nabla u\right) =
\frac{\partial}{\partial x}\left( a(x,y)\frac{\partial u}{\partial x}\right) +
\frac{\partial}{\partial y}\left( a(x,y)\frac{\partial u}{\partial y}\right)
$$
<p>&nbsp;<br>


<p>
<div class="alert alert-block alert-notice alert-text-normal"><b>Integration by parts.</b>

<p>
<p>&nbsp;<br>
$$
\begin{equation}
-\int_{\Omega} \nabla\cdot (a(\x)\nabla u) v\dx =
\int_{\Omega} a(\x)\nabla u\cdot\nabla v \dx -
\int_{\partial\Omega} a\frac{\partial u}{\partial n} v \ds,
\tag{32}
\end{equation}
$$
<p>&nbsp;<br>


<p>

<ul>
 <p><li> \( \int_\Omega ()\dx \): area (2D) or volume (3D) integral</li>
 <p><li> \( \int_{\partial\Omega} ()\ds \): line(2D) or surface (3D) integral</li>
</ul>
<p>
</div>
<p>

<ul>
 <p><li> \( \partial\Omega_N \): Neumann conditions
   \( -a\frac{\partial u}{\partial n} = g \)</li>
 <p><li> \( \partial\Omega_D \): Dirichlet conditions
   \( u = u_0 \)</li>
 <p><li> \( v\in V \) must vanish on \( \partial\Omega_D \)</li>
</ul>
<p>


</section>


<section>

<h3>Example on integration by parts; problem  <a name="___sec79"></a></h3>

<p>
<p>&nbsp;<br>
$$
\begin{align}
\v\cdot\nabla u + \alpha u &= \nabla\cdot\left( a\nabla u\right) + f,
\quad\x\in\Omega\\ 
u &= u_0,\quad\x\in\partial\Omega_D\\ 
-a\frac{\partial u}{\partial n} &= g,\quad\x\in\partial\Omega_N
\end{align}
$$
<p>&nbsp;<br>


<p>

<ul>
 <p><li> Known: \( a \), \( \alpha \), \( f \), \( u_0 \), and \( g \).</li>
 <p><li> Second-order PDE: must have <em>exactly one boundary condition at each
   point of the boundary</em></li>
</ul>
<p>

<p>&nbsp;<br>
$$ u = u_0 + \sum_{j\in\If} c_j\baspsi_j  $$
<p>&nbsp;<br>


<p>

</section>


<section>

<h3>Example on integration by parts; details (1)  <a name="___sec80"></a></h3>

<p>
Galerkin's method: multiply by \( v\in V \) and integrate over \( \Omega \),

<p>
<p>&nbsp;<br>
$$
\int_{\Omega} (\v\cdot\nabla u + \alpha u)v\dx =
\int_{\Omega} \nabla\cdot\left( a\nabla u\right)\dx + \int_{\Omega}fv \dx
$$
<p>&nbsp;<br>


<p>
Integrate second-order term by parts:

<p>
<p>&nbsp;<br>
$$
\int_{\Omega} \nabla\cdot\left( a\nabla u\right) v \dx =
-\int_{\Omega} a\nabla u\cdot\nabla v\dx
+ \int_{\partial\Omega} a\frac{\partial u}{\partial n} v\ds,
$$
<p>&nbsp;<br>


<p>
Result:

<p>
<p>&nbsp;<br>
$$
\int_{\Omega} (\v\cdot\nabla u + \alpha u)v\dx =
-\int_{\Omega} a\nabla u\cdot\nabla v\dx
+ \int_{\partial\Omega} a\frac{\partial u}{\partial n} v\ds
+ \int_{\Omega} fv \dx
$$
<p>&nbsp;<br>


<p>

</section>


<section>

<h3>Example on integration by parts; details (2)  <a name="___sec81"></a></h3>

<p>
Note: \( v\neq 0 \) only on \( \partial\Omega_N \):

<p>
<p>&nbsp;<br>
$$ \int_{\partial\Omega} a\frac{\partial u}{\partial n} v\ds
= \int_{\partial\Omega_N} a\frac{\partial u}{\partial n} v\ds
$$
<p>&nbsp;<br>


<p>
Insert flux condition \( a\frac{\partial u}{\partial n}=-g \) on \( \partial\Omega_N \):

<p>
<p>&nbsp;<br>
$$
\int_{\partial\Omega_N} a\frac{\partial u}{\partial n} v\ds =
-\int_{\partial\Omega_N} gv\ds
$$
<p>&nbsp;<br>


<p>
The final variational form:

<p>
<p>&nbsp;<br>
$$
\int_{\Omega} (\v\cdot\nabla u + \alpha u)v\dx =
-\int_{\Omega} a\nabla u\cdot\nabla v \dx
- \int_{\partial\Omega} g v\ds
+ \int_{\Omega} fv \dx
$$
<p>&nbsp;<br>


<p>
With inner product notation:

<p>
<p>&nbsp;<br>
$$
(\v\cdot\nabla u, v) + (\alpha u,v) =
- (a\nabla u,\nabla v) - (g,v)_{N} + (f,v)
$$
<p>&nbsp;<br>


<p>
\( (g,v)_{N} \): line or surface integral over \( \partial\Omega_N \).

<p>

</section>


<section>

<h3>Example on integration by parts; linear system  <a name="___sec82"></a></h3>

<p>
<p>&nbsp;<br>
$$ u = u_0 + \sum_{j\in\If} c_j\baspsi_j  $$
<p>&nbsp;<br>


<p>
<p>&nbsp;<br>
$$
A_{i,j} = (\v\cdot\nabla \basphi_j, \basphi_i) +
(\alpha \basphi_j ,\basphi_i) + (a\nabla \basphi_j,\nabla \basphi_i)
$$
<p>&nbsp;<br>


<p>
<p>&nbsp;<br>
$$
b_i = (g,\basphi_i)_{N} + (f,\basphi_i) -
(\v\cdot\nabla u_0, \basphi_i) + (\alpha u_0 ,\basphi_i) +
(a\nabla u_0,\nabla \basphi_i),
$$
<p>&nbsp;<br>


<p>

</section>


<section>

<h3>Transformation to a reference cell in 2D and 3D (1)  <a name="___sec83"></a></h3>

<p>
<div class="alert alert-block alert-block alert-text-normal"><b></b>
We want to compute an integral in the physical domain
by integrating over the reference cell.
</div>
<p>
<p>&nbsp;<br>
$$
\begin{equation}
\int_{{\Omega}^{(e)}} a(\x)\nabla\basphi_i\cdot\nabla\basphi_j\dx
\end{equation}
$$
<p>&nbsp;<br>


<p>
Mapping from reference to physical coordinates:

<p>
<p>&nbsp;<br>
$$ \x(\X), $$
<p>&nbsp;<br>


<p>
with Jacobian \( J \),

<p>
<p>&nbsp;<br>
$$ J_{i,j}=\frac{\partial x_j}{\partial X_i} $$
<p>&nbsp;<br>


<p>

<ul>
 <p><li> Step 1: \( \dx \rightarrow \det J\dX \).</li>
 <p><li> Step 2: express \( \nabla\basphi_i \) by an expression with \( \refphi_r \) (\( i=q(e,r) \))</li>
 <p><li> We want \( \nabla_{\x}\refphi_r(\X) \) (derivatives wrt \( \x \))</li>
 <p><li> What we readily have: \( \nabla_{\X}\refphi_r(\X) \) (derivative wrt \( \X \))</li>
 <p><li> Need to transform \( \nabla_{\X}\refphi_r(\X) \) to \( \nabla_{\x}\refphi_r(\X) \)</li>
</ul>
<p>


</section>


<section>

<h3>Transformation to a reference cell in 2D and 3D (2)  <a name="___sec84"></a></h3>

<p>
Can derive

<p>
<p>&nbsp;<br>
$$
\begin{align*}
\nabla_{\X}\refphi_r &= J\cdot\nabla_{\x}\basphi_i\\ 
\nabla_{\x}\basphi_i &= J^{-1}\cdot\nabla_{\X}\refphi_r
\end{align*}
$$
<p>&nbsp;<br>


<p>
Integral transformation from physical to reference coordinates:

<p>
<p>&nbsp;<br>
$$
\begin{equation}
\int_{\Omega}^{(e)} a(\x)\nabla_{\x}\basphi_i\cdot\nabla_{\x}\basphi_j\dx
\int_{\tilde\Omega^r} a(\x(\X))(J^{-1}\cdot\nabla_{\X}\refphi_r)\cdot
(J^{-1}\cdot\nabla\refphi_s)\det J\dX
\end{equation}
$$
<p>&nbsp;<br>


<p>

</section>


<section>

<h2>Time-dependent problems  <a name="___sec85"></a></h2>

<p>

<ul>
 <p><li> So far: used the finite element framework for discretizing in space</li>
 <p><li> What about \( u_t = u_{xx} + f \)?</li>
 <p><li> Use finite differences in time</li>
 <p><li> Solve a recursive set of spatial problems by the finite element method</li>
</ul>
<p>


</section>


<section>

<h3>Example: diffusion problem  <a name="___sec86"></a></h3>

<p>
<p>&nbsp;<br>
$$
\begin{align}
\frac{\partial u}{\partial t} &= \alpha\nabla^2 u + f(\x, t),\quad \x\in\Omega, t\in (0,T]
\tag{33}\\ 
u(\x, 0) & = I(\x),\quad \x\in\Omega
\tag{34}\\ 
\frac{\partial u}{\partial n} &= 0,\quad\x\in\partial\Omega,\ t\in (0,T]
\tag{35}
\tp
\end{align}
$$
<p>&nbsp;<br>


<p>

</section>


<section>

<h3>A Forward Euler scheme; ideas  <a name="___sec87"></a></h3>

<p>
<p>&nbsp;<br>
$$
\begin{equation}
[D_t^+ u = \alpha\nabla^2 u + f(\x, t)]^n,\quad n=1,2,\ldots,N_t-1
\end{equation}
$$
<p>&nbsp;<br>


<p>
<p>&nbsp;<br>
$$
\begin{equation}
u^{n+1} = u^n + \Delta t \left( \alpha\nabla^2 u^n + f(\x, t_n)\right)
\tag{36}
\tp
\end{equation}
$$
<p>&nbsp;<br>


<p>

<ul>
 <p><li> \( u^n = \sum_jc_j^n\baspsi_j \)</li>
 <p><li> Compute \( u^0 \) from \( I \)</li>
 <p><li> Compute \( u^{n+1} \) from \( u^n \)</li>
</ul>
<p>


</section>


<section>

<h3>A Forward Euler scheme; stages in the discretization  <a name="___sec88"></a></h3>

<p>

<ul>
 <p><li> \( \uex(\x,t) \): exact solution of the space-and time-continuous problem</li>
 <p><li> \( \uex^n(\x) \): exact solution of time-discrete problem (after applying
   a finite difference scheme in time)</li>
 <p><li> \( u^n = \sum_{j\in\If}c_j^n\baspsi_j \): solution at the time- and space-discrete problem (after applying a Galerkin method in space)</li>
</ul>
<p>

<p>&nbsp;<br>
$$
\begin{equation}
\frac{\partial \uex}{\partial t} = \alpha\nabla^2 \uex + f(\x, t)
\tag{37}
\end{equation}
$$
<p>&nbsp;<br>


<p>
<p>&nbsp;<br>
$$
\begin{equation}
\uex^{n+1} = \uex^n + \Delta t \left( \alpha\nabla^2 \uex^n + f(\x, t_n)\right)
\tag{38}
\end{equation}
$$
<p>&nbsp;<br>


<p>

</section>


<section>

<h3>A Forward Euler scheme; weighted residual (or Galerkin) principle  <a name="___sec89"></a></h3>

<p>
<p>&nbsp;<br>
$$
\begin{align}
\uex^n &\approx u^n = \sum_{j=0}^{N_s} c_j^{n}\basphi_j(\x)
\tag{39}\\ 
\uex^{n+1} &\approx u^{n+1} = \sum_{j=0}^{N_s} c_j^{n+1}\basphi_j(\x)
\tag{40}
\end{align}
$$
<p>&nbsp;<br>


<p>
<p>&nbsp;<br>
$$ R = u^{n+1} - u^n - \Delta t \left( \alpha\nabla^2 u^n + f(\x, t_n)\right)$$
<p>&nbsp;<br>


<p>
The weighted residual principle,

<p>
<p>&nbsp;<br>
$$ \int_\Omega Rw_i\dx = 0,\quad i=0,\ldots,N_s,$$
<p>&nbsp;<br>


<p>
results in

<p>
<p>&nbsp;<br>
$$
\int_\Omega
\left\lbrack
u^{n+1} - u^n - \Delta t \left( \alpha\nabla^2 u^n + f(\x, t_n)\right)
\right\rbrack w_i \dx =0, \quad i=0,\ldots,N
$$
<p>&nbsp;<br>


<p>
Galerkin: \( w_i=\baspsi_i \)

<p>

</section>


<section>

<h3>A Forward Euler scheme; integration by parts  <a name="___sec90"></a></h3>

<p>
Isolating the unknown \( u^{n+1} \) on the left-hand side:

<p>
<p>&nbsp;<br>
$$
\int_{\Omega} u^{n+1}\basphi_i\dx = \int_{\Omega}
\left\lbrack u^n - \Delta t \left( \alpha\nabla^2 u^n + f(\x, t_n)\right)
\right\rbrack\baspsi_i\dx
$$
<p>&nbsp;<br>


<p>
Integration by parts:

<p>
<p>&nbsp;<br>
$$ \int_{\Omega}\alpha\nabla^2 u^n\baspsi_i \dx =
-\int_{\Omega}\alpha\nabla u^n\cdot\nabla\baspsi_i\dx +
\underbrace{\int_{\partial\Omega}\alpha\frac{\partial u^n}{\partial n}\baspsi \dx}_{=0 \hbox{ because }\partial u^n/\partial n=0}
$$
<p>&nbsp;<br>


<p>
<div class="alert alert-block alert-block alert-text-normal"><b></b>
<p>&nbsp;<br>
$$
\begin{equation}
\int_{\Omega} u^{n+1}\baspsi_i\dx =
\int_{\Omega} u^n\baspsi_i\dx -
\Delta t \int_{\Omega}\alpha\nabla u^n\cdot\nabla\baspsi_i\dx +
\Delta t\int_{\Omega}f^n\baspsi_i\dx
\tag{41}
\end{equation}
$$
<p>&nbsp;<br>
</div>
<p>


</section>



</div> <!-- class="slides" -->
</div> <!-- class="reveal" -->

<script src="reveal.js/lib/js/head.min.js"></script>
<script src="reveal.js/js/reveal.min.js"></script>

<script>

// Full list of configuration options available here:
// https://github.com/hakimel/reveal.js#configuration
Reveal.initialize({
controls: true,
progress: true,
history: true,
center: true,
theme: Reveal.getQueryHash().theme, // available themes are in reveal.js/css/theme
transition: Reveal.getQueryHash().transition || 'default', // default/cube/page/concave/zoom/linear/none

// Optional libraries used to extend on reveal.js
dependencies: [
{ src: 'reveal.js/lib/js/classList.js', condition: function() { return !document.body.classList; } },
{ src: 'reveal.js/plugin/markdown/showdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
{ src: 'reveal.js/plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
{ src: 'reveal.js/plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
{ src: 'reveal.js/plugin/zoom-js/zoom.js', async: true, condition: function() { return !!document.body.classList; } },
{ src: 'reveal.js/plugin/notes/notes.js', async: true, condition: function() { return !!document.body.classList; } }
// { src: 'reveal.js/plugin/remotes/remotes.js', async: true, condition: function() { return !!document.body.classList; } }
]
});
</script>


</body>
</html>
